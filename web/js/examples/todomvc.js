define(["knockout","ojs/ojknockout","director"],(function(t){return function(){let e=this;e.todoStorage={fetch:function(){var o=JSON.parse(localStorage.getItem("todos-vuejs-2.0")||"[]");return o.forEach((function(e,o){e.id=o,e.title=t.observable(e.title),e.completed=t.observable(e.completed)})),e.todoStorage.uid=o.length,o},save:function(t){let e=t.map(t=>{let e=Object.assign({},t);return e.title=t.title(),e.completed=t.completed(),e});localStorage.setItem("todos-vuejs-2.0",JSON.stringify(e))}},e.filters={all:function(t){return t},active:function(t){return t.filter((function(t){return!t.completed()}))},completed:function(t){return t.filter((function(t){return t.completed()}))}},this.todos=t.observableArray(this.todoStorage.fetch()),this.visibility=t.observable("all"),this.newTodo=t.observable(),this.beforeEditCache=null,this.editedTodo=t.observable(),this.allDone=t.observable(!1),this.todos.subscribe(t=>{e.todoStorage.save(t)}),this.remaining=t.computed((function(){return this.filters.active(this.todos()).length}),this),this.allDoneClicked=()=>(this.todos().forEach(t=>{t.completed(this.allDone())}),this.todos.valueHasMutated(),!0),this.itemCompleted=()=>(this.todos.valueHasMutated(),!0),this.pluralize=t=>1===t?"item":"items",this.filteredTodos=t.computed((function(){return e.filters[this.visibility()](this.todos())}),this),this.addTodo=(o,i)=>{if(13==(i.which||i.keyCode)){var s=this.newTodo()&&this.newTodo().trim();return!!s&&(this.todos.push({id:e.todoStorage.uid++,title:t.observable(s),completed:t.observable(!1)}),this.newTodo(""),!1)}return!0},this.removeTodo=t=>{this.todos.splice(this.todos().indexOf(t),1)},this.editTodo=t=>{this.beforeEditCache=t.title(),this.editedTodo(t)},this.keydownEdit=(t,e)=>{let o=t.which||t.keyCode;return 13==o?(this.doneEdit(e),!1):27!=o||(this.cancelEdit(e),!1)},this.doneEdit=t=>{this.editedTodo()&&(this.editedTodo(null),t.title(t.title().trim()),t.title()||this.removeTodo(t))},this.cancelEdit=t=>{console.log(t),this.editedTodo(null),t.title(this.beforeEditCache)},this.removeCompleted=()=>{this.todos(e.filters.active(this.todos()))},this.connected=()=>{function t(){var t=window.location.hash.replace(/#\/?/,"");e.filters[t]?e.visibility(t):(window.location.hash="",e.visibility("all"))}window.addEventListener("hashchange",t),t()}}}));