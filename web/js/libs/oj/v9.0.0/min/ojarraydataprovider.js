/**
 * @license
 * Copyright (c) 2014, 2020, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
"use strict";define(["ojs/ojcore","jquery","ojs/ojset","ojs/ojmap","ojs/ojdataprovider","ojs/ojlogger","ojs/ojeventtarget"],function(t,e,i,s,n,r){class a{constructor(t,e){this.data=t,this.options=e,this.Item=class{constructor(t,e,i){this._parent=t,this.metadata=e,this.data=i,this[a._METADATA]=e,this[a._DATA]=i}},this.ItemMetadata=class{constructor(t,e){this._parent=t,this.key=e,this[a._KEY]=e}},this.FetchByKeysResults=class{constructor(t,e,i){this._parent=t,this.fetchParameters=e,this.results=i,this[a._FETCHPARAMETERS]=e,this[a._RESULTS]=i}},this.ContainsKeysResults=class{constructor(t,e,i){this._parent=t,this.containsParameters=e,this.results=i,this[a._CONTAINSPARAMETERS]=e,this[a._RESULTS]=i}},this.FetchByOffsetResults=class{constructor(t,e,i,s){this._parent=t,this.fetchParameters=e,this.results=i,this.done=s,this[a._FETCHPARAMETERS]=e,this[a._RESULTS]=i,this[a._DONE]=s}},this.FetchListParameters=class{constructor(t,e,i,s,n){this._parent=t,this.size=e,this.sortCriteria=i,this.filterCriterion=s,this.attributes=n,this[a._SIZE]=e,this[a._SORTCRITERIA]=i,this[a._FILTERCRITERION]=s,this[a._ATTRIBUTES]=n}},this.FetchListResult=class{constructor(t,e,i,s){this._parent=t,this.fetchParameters=e,this.data=i,this.metadata=s,this[a._FETCHPARAMETERS]=e,this[a._DATA]=i,this[a._METADATA]=s}},this.AsyncIterable=class{constructor(t,e){this._parent=t,this._asyncIterator=e,this[Symbol.asyncIterator]=function(){return this._asyncIterator}}},this.AsyncIterator=class{constructor(t,e,i,s){this._parent=t,this._nextFunc=e,this._params=i,this._offset=s,this._clientId=i&&i.clientId||Symbol(),t._mapClientIdToOffset.set(this._clientId,s),this._cacheObj={},this._cacheObj[a._MUTATIONSEQUENCENUM]=t._mutationSequenceNum}next(){const t=this._parent._mapClientIdToOffset.get(this._clientId);let e=this._nextFunc(this._params,t,this._cacheObj);return this._parent._mapClientIdToOffset.set(this._clientId,e.offset),Promise.resolve(e.result)}},this.AsyncIteratorYieldResult=class{constructor(t,e){this._parent=t,this.value=e,this[a._VALUE]=e,this[a._DONE]=!1}},this.AsyncIteratorReturnResult=class{constructor(t,e){this._parent=t,this.value=e,this[a._VALUE]=e,this[a._DONE]=!0}},this.DataProviderMutationEventDetail=class{constructor(t,e,i,s){this._parent=t,this.add=e,this.remove=i,this.update=s,this[a._ADD]=e,this[a._REMOVE]=i,this[a._UPDATE]=s}},this.DataProviderOperationEventDetail=class{constructor(t,e,i,s,n){this._parent=t,this.keys=e,this.metadata=i,this.data=s,this.indexes=n,this[a._KEYS]=e,this[a._METADATA]=i,this[a._DATA]=s,this[a._INDEXES]=n}},this.DataProviderAddOperationEventDetail=class{constructor(t,e,i,s,n,r,l){this._parent=t,this.keys=e,this.afterKeys=i,this.addBeforeKeys=s,this.metadata=n,this.data=r,this.indexes=l,this[a._KEYS]=e,this[a._AFTERKEYS]=i,this[a._ADDBEFOREKEYS]=s,this[a._METADATA]=n,this[a._DATA]=r,this[a._INDEXES]=l}},this._cachedIndexMap=[],this._sequenceNum=0,this._mutationSequenceNum=0,this._mapClientIdToOffset=new Map,this._subscribeObservableArray(t),null!=e&&null!=e[a._KEYS]&&(this._keysSpecified=!0,this._keys=e[a._KEYS])}containsKeys(t){let e=this;return this.fetchByKeys(t).then(function(s){let n=new i;return t[a._KEYS].forEach(function(t){null!=s[a._RESULTS].get(t)&&n.add(t)}),Promise.resolve(new e.ContainsKeysResults(e,t,n))})}fetchByKeys(e){let i=this;this._generateKeysIfNeeded();let n,r=new s,l=this._getKeys(),o=null!=e?e[a._ATTRIBUTES]:null,u=0;if(e){let s=i._getRowData();return e[a._KEYS].forEach(function(e){for(n=null,u=0;u<l.length;u++)if(t.Object.compareValues(l[u],e)){n=u;break}if(null!=n&&n>=0){let t=s[n];if(o&&o.length>0){let e={};i._filterRowAttributes(o,t,e),t=e}r.set(e,new i.Item(i,new i.ItemMetadata(i,e),t))}}),Promise.resolve(new i.FetchByKeysResults(i,e,r))}return Promise.reject("Keys are a required parameter")}fetchByOffset(t){let e=this,i=null!=t?t[a._SIZE]:-1,s=null!=t?t[a._SORTCRITERIA]:null,n=null!=t&&t[a._OFFSET]>0?t[a._OFFSET]:0,r=null!=t?t[a._ATTRIBUTES]:null,l=null!=t?t[a._FILTERCRITERION]:null;this._generateKeysIfNeeded();let o=[],u=!0;if(t){let h=new this.FetchListParameters(this,i,s,l,r),_=this._fetchFrom(h,n).result,c=_[a._VALUE];u=_[a._DONE];let f=c[a._DATA],d=c[a._METADATA].map(function(t){return t[a._KEY]});return o=f.map(function(t,i){return new e.Item(e,new e.ItemMetadata(e,d[i]),t)}),Promise.resolve(new this.FetchByOffsetResults(this,t,o,u))}return Promise.reject("Offset is a required parameter")}fetchFirst(t){return new this.AsyncIterable(this,new this.AsyncIterator(this,this._fetchFrom.bind(this),t,0))}getCapability(t){return a.getCapability(t)}static getCapability(t){if("sort"==t)return{attributes:"multiple"};if("fetchByKeys"==t)return{implementation:"lookup"};if("fetchByOffset"==t)return{implementation:"randomAccess"};if("fetchCapability"==t){let t=new Set;return t.add("exclusion"),{attributeFilter:{expansion:{},ordering:{},defaultShape:{features:t}}}}return"filter"==t?{operators:["$co","$eq","$ew","$pr","$gt","$ge","$lt","$le","$ne","$regex","$sw"],attributeExpression:["*"],textFilter:{}}:null}getTotalSize(){return Promise.resolve(this._getRowData().length)}isEmpty(){return this._getRowData().length>0?"no":"yes"}createOptimizedKeySet(t){return new i(t)}createOptimizedKeyMap(t){if(t){let e=new s;return t.forEach(function(t,i){e.set(i,t)}),e}return new s}_getRowData(){return this[a._DATA]instanceof Array?this[a._DATA]:this[a._DATA]()}_getKeys(){return null==this._keys||this._keys instanceof Array?this._keys:this._keys()}_indexOfKey(e){let i,s=this._getKeys(),n=-1;for(i=0;i<s.length;i++)if(t.Object.compareValues(s[i],e)){n=i;break}return n}_adjustIteratorOffset(t){this._mapClientIdToOffset.forEach((e,i)=>{let s=0,n=0;t.forEach(function(t){t.index<e&&("deleted"===t.status?++n:"added"===t.status&&++s)}),this._mapClientIdToOffset.set(i,e+s-n)})}_subscribeObservableArray(e){if(!(e instanceof Array)){if(!this._isObservableArray(e))throw new Error("Invalid data type. ArrayDataProvider only supports Array or observableArray.");let s=this;e.subscribe(function(e){let n,a,l,o,u,h=[],_=[],c=[],f=[],d=[];s._mutationSequenceNum++;let E=!0,p=!0;e.forEach(function(t){"deleted"===t.status?(E=!1,0):"added"===t.status&&(p=!1,0)}),s._adjustIteratorOffset(e);let A=[],T=[],m=null,y=null,R=null,I=s._generateKeysIfNeeded();if(!E&&!p){for(n=0;n<e.length;n++){o=e[n].index,u=e[n].status;let i=s._getId(e[n].value);for(a=0;a<e.length;a++)a!=n&&o===e[a].index&&u!==e[a].status&&A.indexOf(n)<0&&T.indexOf(n)<0&&(null==i||t.Object.compareValues(i,s._getId(e[a].value)))&&("deleted"===u?(T.push(n),A.push(a)):(T.push(a),A.push(n)))}for(n=0;n<e.length;n++)if(A.indexOf(n)>=0){let t=s._getKeys()[e[n].index];_.push(t),h.push(e[n].value),c.push(e[n].index)}if(_.length>0){f=_.map(function(t){return new s.ItemMetadata(s,t)});let t=new i;_.map(function(e){t.add(e)}),m=new s.DataProviderOperationEventDetail(s,t,f,h,c)}}if(h=[],_=[],c=[],!E){for(n=0;n<e.length;n++)"deleted"===e[n].status&&A.indexOf(n)<0&&T.indexOf(n)<0&&(_.push(s._getKeys()[e[n].index]),h.push(e[n].value),c.push(e[n].index));if(_.length>0&&_.map(function(t){let e=s._indexOfKey(t);s._keys.splice(e,1)}),_.length>0){f=_.map(function(t){return new s.ItemMetadata(s,t)});let t=new i;_.map(function(e){t.add(e)}),R=new s.DataProviderOperationEventDetail(s,t,f,h,c)}}if(h=[],_=[],c=[],!p){let t=null==s._getKeys()||!(s._getKeys().length>0);for(n=0;n<e.length;n++)"added"===e[n].status&&A.indexOf(n)<0&&T.indexOf(n)<0&&(null==(l=s._getId(e[n].value))&&(I||s._keysSpecified)&&(l=s._getKeys()[e[n].index]),null==l?(l=s._sequenceNum++,s._keys.splice(e[n].index,0,l)):t||-1===s._indexOfKey(l)?s._keys.splice(e[n].index,0,l):I||(r.warn("added row has duplicate key "+l),s._keys.splice(e[n].index,0,l)),_.push(l),h.push(e[n].value),c.push(e[n].index));for(n=0;n<e.length;n++)if("added"===e[n].status&&A.indexOf(n)<0&&T.indexOf(n)<0){let t=s._getKeys()[e[n].index+1];t=null==t?null:t,d.push(t)}if(_.length>0){f=_.map(function(t){return new s.ItemMetadata(s,t)});let t=new i;_.map(function(e){t.add(e)});let e=new i;d.map(function(t){e.add(t)}),y=new s.DataProviderAddOperationEventDetail(s,t,e,d,f,h,c)}}s._fireMutationEvent(y,R,m)},null,"arrayChange"),e.subscribe(function(e){s._mutationEvent?s.dispatchEvent(s._mutationEvent):s._mutationRemoveEvent||s._mutationAddEvent||s._mutationUpdateEvent?(s._mutationRemoveEvent&&s.dispatchEvent(s._mutationRemoveEvent),s._mutationAddEvent&&s.dispatchEvent(s._mutationAddEvent),s._mutationUpdateEvent&&s.dispatchEvent(s._mutationUpdateEvent)):s.dispatchEvent(new t.DataProviderRefreshEvent),s._mutationEvent=null,s._mutationRemoveEvent=null,s._mutationAddEvent=null,s._mutationUpdateEvent=null},null,"change")}}_fireMutationEvent(e,i,s){let n=this,r=!1;if(["keys","indexes"].forEach(function(t){r||(r=n._hasSamePropValue(i,e,t)||n._hasSamePropValue(i,s,t)||n._hasSamePropValue(e,s,t))}),r){if(i){let e=new this.DataProviderMutationEventDetail(this,null,i,null);this._mutationRemoveEvent=new t.DataProviderMutationEvent(e)}if(e){let i=new this.DataProviderMutationEventDetail(this,e,null,null);this._mutationAddEvent=new t.DataProviderMutationEvent(i)}if(s){let e=new this.DataProviderMutationEventDetail(this,null,null,s);this._mutationUpdateEvent=new t.DataProviderMutationEvent(e)}}else{let n=new this.DataProviderMutationEventDetail(this,e,i,s);this._mutationEvent=new t.DataProviderMutationEvent(n)}}_hasSamePropValue(e,i,s){const n="_hasSamePropValue is true";try{e&&e[s]&&e[s].forEach(function(e){i&&i[s]&&i[s].forEach(function(i){if(t.Object.compareValues(e,i))throw n})})}catch(t){if(t===n)return!0;throw t}return!1}_isObservableArray(t){return"function"==typeof t&&t.subscribe&&!(void 0===t.destroyAll)}_generateKeysIfNeeded(){if(null==this._keys){let t=null!=this.options?this.options[a._KEYATTRIBUTES]||this.options[a._IDATTRIBUTE]:null;this._keys=[];let e,i=this._getRowData(),s=0;for(s=0;s<i.length;s++)null!=(e=this._getId(i[s]))&&"@index"!=t||(e=this._sequenceNum++),this._keys[s]=e;return!0}return!1}_getId(t){let e,i=null!=this.options?this.options[a._KEYATTRIBUTES]||this.options[a._IDATTRIBUTE]:null;if(null!=i){if(Array.isArray(i)){let s;for(e=[],s=0;s<i.length;s++)e[s]=this._getVal(t,i[s])}else e="@value"==i?this._getAllVals(t):this._getVal(t,i);return e}return null}_getVal(t,e){return"function"==typeof t[e]?t[e]():t[e]}_getAllVals(t){let e=this;return Object.keys(t).map(function(i){return e._getVal(t,i)})}_fetchFrom(t,e,i){let s=this,r=null!=t?t[a._ATTRIBUTES]:null;this._generateKeysIfNeeded();let l=null!=t?t[a._SORTCRITERIA]:null,o=this._getCachedIndexMap(l,i),u=this._getRowData(),h=o.map(function(t){return u[t]}),_=o.map(function(t){return s._getKeys()[t]}),c=null!=t?t[a._SIZE]>0?t[a._SIZE]:t[a._SIZE]<0?s._getKeys().length:25:25,f=e+c<h.length,d=this._mergeSortCriteria(l);null!=d&&((t=t||{})[a._SORTCRITERIA]=d);let E,p=[],A=[],T=0;if(null!=t&&t[a._FILTERCRITERION]){let i=null;i=n.FilterFactory.getFilter({filterDef:t[a._FILTERCRITERION],filterOptions:this.options});let s=0;for(;p.length<c&&s<h.length;)i.filter(h[s])&&(T>=e&&(p.push(h[s]),A.push(_[s])),T++),s++;f=s<h.length}else p=h.slice(e,e+c),A=_.slice(e,e+c);T=e+p.length,E=p.map(function(t){if(r&&r.length>0){let e={};s._filterRowAttributes(r,t,e),t=e}return t});let m=A.map(function(t){return new s.ItemMetadata(s,t)}),y=new this.FetchListResult(this,t,E,m);return f?{result:new this.AsyncIteratorYieldResult(this,y),offset:T}:{result:new this.AsyncIteratorReturnResult(this,y),offset:T}}_getCachedIndexMap(t,e){if(e&&e.indexMap&&e[a._MUTATIONSEQUENCENUM]===this._mutationSequenceNum)return e.indexMap;let i=this._getRowData().map(function(t,e){return e}),s=this._sortData(i,t);return e&&(e.indexMap=s,e[a._MUTATIONSEQUENCENUM]=this._mutationSequenceNum),s}_sortData(t,e){let i=this._getRowData(),s=t.map(function(t){return{index:t,value:i[t]}});return null!=e&&s.sort(this._getSortComparator(e)),s.map(function(t){return t.index})}_getSortComparator(t){let e=this;return function(i,s){let n,r,l,o,u,h,_=null!=e.options?e.options[a._SORTCOMPARATORS]:null;for(n=0;n<t.length;n++)if(r=t[n][a._DIRECTION],l=t[n][a._ATTRIBUTE],o=null,null!=_&&(o=_[a._COMPARATORS].get(l)),u=e._getVal(i.value,l),h=e._getVal(s.value,l),null!=o){let t="descending"==r?-1:1,e=o(u,h)*t;if(0!=e)return e}else{let t=0,e="string"==typeof u?u:new String(u).toString(),i="string"==typeof h?h:new String(h).toString();if(0!=(t="ascending"==r?e.localeCompare(i,void 0,{numeric:!0,sensitivity:"base"}):i.localeCompare(e,void 0,{numeric:!0,sensitivity:"base"})))return t}return 0}}_mergeSortCriteria(t){let e=null!=this.options?this.options[a._IMPLICITSORT]:null;if(null!=e){if(null==t)return e;let i,s,n,r=t.slice(0);for(i=0;i<e.length;i++){for(n=!1,s=0;s<r.length;s++)r[s][a._ATTRIBUTE]==e[i][a._ATTRIBUTE]&&(n=!0);n||r.push(e[i])}return r}return t}_filterRowAttributes(t,e,i){let s=this;if(Array.isArray(t)){let n,r=!1;t.forEach(function(t){t!=a._ATDEFAULT&&t.name!=a._ATDEFAULT||(r=!0)}),Object.keys(e).forEach(function(a){if(r){let r,l=!1,o=a;for(n=0;n<t.length;n++)if((r=t[n]instanceof Object?t[n].name:t[n]).startsWith("!")){if((r=r.substr(1,r.length-1))==a){l=!0;break}}else if(r==a){o=t[n];break}l||s._filterRowAttributes(o,e,i)}else t.forEach(function(t){let n;(n=t instanceof Object?t.name:t).startsWith("!")||n!=a||s._filterRowAttributes(t,e,i)})})}else if(t instanceof Object){let n=t.name,r=t.attributes;if(n&&!n.startsWith("!"))if(e[n]instanceof Object&&!Array.isArray(e[n])&&r){let t={};s._filterRowAttributes(r,e[n],t),i[n]=t}else if(Array.isArray(e[n])&&r){let t;i[n]=[],e[n].forEach(function(e,a){t={},s._filterRowAttributes(r,e,t),i[n][a]=t})}else s._proxyAttribute(i,e,n)}else s._proxyAttribute(i,e,t)}_proxyAttribute(t,e,i){t&&e&&Object.defineProperty(t,i,{get:function(){return e[i]},set:function(t){e[i]=t},enumerable:!0})}}
/**
 * @preserve Copyright 2013 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
/**
 * @preserve Copyright 2013 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
return a._KEY="key",a._KEYS="keys",a._AFTERKEYS="afterKeys",a._ADDBEFOREKEYS="addBeforeKeys",a._DIRECTION="direction",a._ATTRIBUTE="attribute",a._ATTRIBUTES="attributes",a._SORT="sort",a._SORTCRITERIA="sortCriteria",a._FILTERCRITERION="filterCriterion",a._DATA="data",a._METADATA="metadata",a._INDEXES="indexes",a._OFFSET="offset",a._SIZE="size",a._IDATTRIBUTE="idAttribute",a._IMPLICITSORT="implicitSort",a._KEYATTRIBUTES="keyAttributes",a._SORTCOMPARATORS="sortComparators",a._COMPARATORS="comparators",a._COMPARATOR="comparator",a._RESULTS="results",a._CONTAINS="contains",a._FETCHPARAMETERS="fetchParameters",a._CONTAINSPARAMETERS="containsParameters",a._VALUE="value",a._DONE="done",a._ADD="add",a._REMOVE="remove",a._UPDATE="update",a._DETAIL="detail",a._FETCHLISTRESULT="fetchListResult",a._ATDEFAULT="@default",a._MUTATIONSEQUENCENUM="mutationSequenceNum",t.ArrayDataProvider=a,t.EventTargetMixin.applyMixin(a),a});