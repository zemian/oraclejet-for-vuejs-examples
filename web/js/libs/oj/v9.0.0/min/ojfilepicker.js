define(["exports","ojs/ojcore-base","ojs/ojdomutils","ojs/ojvcomponent","ojs/ojtranslation"],function(e,t,i,r,l){"use strict";
/**
    * @license
    * Copyright (c) 2017 2020, Oracle and/or its affiliates.
    * The Universal Permissive License (UPL), Version 1.0
    * as shown at https://oss.oracle.com/licenses/upl/
    * @ignore
    */var n=function(e,t,i,r){var l,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(l=e[a])&&(s=(n<3?l(s):n>3?l(t,i,s):l(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s};e.FilePicker=class extends r.VComponent{constructor(e){super(e),this.state={focus:!1,validity:"NA"},this.inputElemRef=(e=>{this.inputElem=e}),this.rootElemRef=(e=>{this.rootElem=e})}_handleSelectingFiles(e){return("click"===e.type||"keypress"===e.type&&13===e.keyCode)&&(this.selecting=!0,e.preventDefault(),this.inputElem.value=null,this.inputElem.click(),!0)}_handleFileSelected(e){e.preventDefault(),e.stopPropagation();var t=e.target.files;if(t.length>0){var i=this._validateTypes(t).rejected;i.length>0?this._fireInvalidSelectAction(this._getMimeTypeValidationMessages(i),e,!1):this._handleFilesAdded(t,e)}this.selecting=!1}_handleDragEnter(e){e.preventDefault(),e.stopPropagation()}_handleDragOver(e){e.preventDefault(),e.stopPropagation();var i=e.dataTransfer;if(!this.inDropZone){var r=t.AgentUtils.getAgentInfo();if(this.inDropZone=!0,this.isDroppable=!0,r.browser!==t.AgentUtils.BROWSER.SAFARI&&r.browser!==t.AgentUtils.BROWSER.IE){var n=i.items,s=[],a=this._validateSelectionMode(n),o=this._validateTypes(n);a&&0===o.rejected.length?this.updateState({validity:"valid"}):(this.isDroppable=!1,a?s=this._getMimeTypeValidationMessages(o.rejected):s.push({severity:"error",summary:l.getTranslatedString("oj-ojFilePicker.singleFileUploadError")}),this._fireInvalidSelectAction(s,e,!0))}else this.updateState({validity:"valid"})}}_handleDragLeave(e,t){this.inDropZone&&(e.preventDefault(),e.stopPropagation(),this.rootElem.contains(e.relatedTarget)||(this.inDropZone=!1,this.updateState({validity:"NA"}),this.isDroppable||t||(this.dragPromiseResolver(),this.dragPromiseResolver=null)))}_handleFileDrop(e){if(this.inDropZone){e.preventDefault(),e.stopPropagation();var t=this._createFileList(e.dataTransfer.files),i=!1;if(this.isDroppable){var r=[];if(this._validateSelectionMode(t)){var n=this._validateTypes(t);n.rejected.length>0&&(r=this._getMimeTypeValidationMessages(n.rejected),i=!0)}else r.push({severity:"error",summary:l.getTranslatedString("oj-ojFilePicker.singleFileUploadError")});r.length>0&&(this.isDroppable=!1,this._fireInvalidSelectAction(r,e,!1)),this.isDroppable&&this._handleFilesAdded(t,e)}this._handleDragLeave(e,i)}}_handleFocusIn(e){this.selecting||this.updateState({focus:!i.recentPointer()})}_handleFocusOut(e){this.selecting||this.updateState({focus:!1})}render(){var e,t;const i=this.props,r=null===(t=(e=this.props).trigger)||void 0===t?void 0:t.call(e);if(i.disabled)return this._renderDisabled(i,r);const l="drop"!=i.selectOn?this._handleSelectingFiles:void 0;return r?this._renderWithCustomTrigger(i,r,l):this._renderWithDefaultTrigger(i,l)}_renderDisabled(e,t){const i=t?"oj-filepicker":"oj-filepicker oj-filepicker-no-trigger";return r.h("oj-file-picker",{class:i},r.h("div",{class:"oj-filepicker-disabled oj-filepicker-container"},t||this._renderDefaultTriggerContent(e)))}_renderWithCustomTrigger(e,t,i){const l=this._getDndHandlers(e);return r.h("oj-file-picker",{class:"oj-filepicker"+this._getFocusClass(),ref:this.rootElemRef,onFocusin:this._handleFocusIn,onFocusout:this._handleFocusOut},this._renderInputElement(e),r.h("div",{onClick:i,onKeypress:this._handleSelectingFiles,onDragenter:l.handleDragEnter,onDragover:l.handleDragOver,onDragleave:l.handleDragLeave,onDragend:l.handleDragLeave,onDrop:l.handleFileDrop,class:"oj-filepicker-container"},t))}_renderWithDefaultTrigger(e,t){const i=this.state.validity,l="valid"===i?" oj-valid-drop":"invalid"===i?" oj-invalid-drop":"",n=this._getDndHandlers(e);return r.h("oj-file-picker",{class:"oj-filepicker oj-filepicker-no-trigger",ref:this.rootElemRef},this._renderInputElement(e),r.h("div",{onClick:t,onKeypress:this._handleSelectingFiles,class:"oj-filepicker-container"},r.h("div",{tabindex:"0",class:"oj-filepicker-dropzone"+l+this._getFocusClass(),onDragenter:n.handleDragEnter,onDragover:n.handleDragOver,onDragleave:n.handleDragLeave,onDragend:n.handleDragLeave,onDrop:n.handleFileDrop,onFocusin:this._handleFocusIn,onFocusout:this._handleFocusOut},this._renderDefaultTriggerContent(e))))}_renderDefaultTriggerContent(e){const t="single"==e.selectionMode;return[r.h("div",null,r.h("div",{class:"oj-filepicker-text"},l.getTranslatedString("oj-ojFilePicker.dropzonePrimaryText")),r.h("div",{class:"oj-filepicker-secondary-text"},t?l.getTranslatedString("oj-ojFilePicker.secondaryDropzoneText"):l.getTranslatedString("oj-ojFilePicker.secondaryDropzoneTextMultiple"))),r.h("div",{class:"oj-filepicker-icon oj-fwk-icon-plus oj-fwk-icon"})]}_renderInputElement(e){const t=e.accept,i=t&&t.length?t.join(","):null;return r.h("input",{type:"file",class:"oj-helper-hidden",multiple:"multiple"==this.props.selectionMode,accept:i,ref:this.inputElemRef,onChange:this._handleFileSelected,capture:"implementation"===e.capture?"":e.capture})}_getDndHandlers(e){return"click"!=e.selectOn?{handleDragEnter:this._handleDragEnter,handleDragOver:this._handleDragOver,handleDragLeave:this._handleDragLeave,handleFileDrop:this._handleFileDrop}:{}}_getFocusClass(){return this.state.focus?" oj-focus-highlight":""}_validateSelectionMode(e){return"single"!==this.props.selectionMode||1===e.length}_validateTypes(e){var t,i,r=[],n=[];if(e)for(var s=0;s<e.length;s++){var a=(t=e[s]).name;if(i=l.getTranslatedString("oj-ojFilePicker.unknownFileType"),a){var o=a.split(".");i=o.length>1?"."+o.pop():i}i=t.type?t.type:i,-1===r.indexOf(i)&&-1===n.indexOf(i)&&(this._acceptFile(t)?r.push(i):n.push(i))}return{accepted:r,rejected:n}}_getMimeTypeValidationMessages(e){var t=[];return 1===e.length?t.push({severity:"error",summary:l.getTranslatedString("oj-ojFilePicker.singleFileTypeUploadError",{fileType:e[0]})}):t.push({severity:"error",summary:l.getTranslatedString("oj-ojFilePicker.multipleFileTypeUploadError",{fileTypes:e.join(l.getTranslatedString("oj-converter.plural-separator"))})}),t}_acceptFile(e){var i,r=this.props.accept;if(!r||0===r.length||!e)return!0;for(var l=0;l<r.length;l++){if(!(i=t.StringUtils.trim(r[l])))return!0;if(i.startsWith(".",0)){if(!e.name||e.name&&e.name.endsWith(i))return!0}else{if(!e.type)return!1;if("image/*"===i){if(e.type.startsWith("image/",0))return!0}else if("video/*"===i){if(e.type.startsWith("video/",0))return!0}else if("audio/*"===i){if(e.type.startsWith("audio/",0))return!0}else if(e.type===i)return!0}}return!1}_handleFilesAdded(e,t){var i,r,l=this._createFileList(e);null===(r=(i=this.props).onOjBeforeSelect)||void 0===r||r.call(i,{files:l,originalEvent:t}).then(()=>{var e,i;null===(i=(e=this.props).onOjSelect)||void 0===i||i.call(e,{files:l,originalEvent:t})},e=>{this._fireInvalidSelectAction(e,t,!1)})}_fireInvalidSelectAction(e,t,i){var r,l;i&&this.updateState({validity:"invalid"});var n=i?new Promise(e=>{this.dragPromiseResolver=e}):null;null===(l=(r=this.props).onOjInvalidSelect)||void 0===l||l.call(r,{messages:e,originalEvent:t,until:n})}_createFileList(e){for(var t={length:{value:e.length},item:{value:function(e){return this[e]}}},i=0;i<e.length;i++)t[i]={value:e[i],enumerable:!0};return Object.create(FileList.prototype,t)}},e.FilePicker.metadata={extension:{_DEFAULTS:class{constructor(){this.accept=null,this.capture=null,this.disabled=!1,this.selectOn="auto",this.selectionMode="multiple"}}},properties:{accept:{type:"Array<string>|null",value:null},capture:{type:"string|null",enumValues:["environment","implementation","user"],value:null},disabled:{type:"boolean",value:!1},selectOn:{type:"string",enumValues:["auto","click","clickAndDrop","drop"],value:"auto"},selectionMode:{type:"string",enumValues:["multiple","single"],value:"multiple"}},slots:{trigger:{}},events:{ojBeforeSelect:{cancelable:!0},ojInvalidSelect:{},ojSelect:{}}},n([r.listener()],e.FilePicker.prototype,"_handleSelectingFiles",null),n([r.listener()],e.FilePicker.prototype,"_handleFileSelected",null),n([r.listener()],e.FilePicker.prototype,"_handleDragEnter",null),n([r.listener()],e.FilePicker.prototype,"_handleDragOver",null),n([r.listener()],e.FilePicker.prototype,"_handleDragLeave",null),n([r.listener()],e.FilePicker.prototype,"_handleFileDrop",null),n([r.listener()],e.FilePicker.prototype,"_handleFocusIn",null),n([r.listener()],e.FilePicker.prototype,"_handleFocusOut",null),e.FilePicker=n([r.customElement("oj-file-picker")],e.FilePicker),Object.defineProperty(e,"__esModule",{value:!0})});