/**
 * @license
 * Copyright (c) 2014, 2020, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["ojs/ojcore","jquery","ojs/ojlogger","ojdnd","ojs/ojlistview"],function(t,e,i){"use strict";
/**
 * @preserve Copyright 2013 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */t.ListViewDndContext=function(t){this.listview=t},t.Object.createSubclass(t.ListViewDndContext,t.Object,"oj.ListViewDndContext"),t.ListViewDndContext.C_KEY=67,t.ListViewDndContext.V_KEY=86,t.ListViewDndContext.X_KEY=88,t.ListViewDndContext.CUT_COMMAND="cut",t.ListViewDndContext.COPY_COMMAND="copy",t.ListViewDndContext.PASTE_COMMAND="paste",t.ListViewDndContext.PASTE_BEFORE_COMMAND="pasteBefore",t.ListViewDndContext.PASTE_AFTER_COMMAND="pasteAfter",t.ListViewDndContext.prototype.reset=function(){this._unsetSelectionDraggable(),this.m_itemsDragged=null,this.m_dragImage=null,this.m_currentDragItem=null,this.m_dragItems=null,this.m_contextMenuItem=null,this.m_cachedOffset=null},t.ListViewDndContext.prototype._getDndOptions=function(t){var e=this.listview.GetOption("dnd");return null!=e&&e[t]?e[t].items:null},t.ListViewDndContext.prototype._getDragOptions=function(){return this._getDndOptions("drag")},t.ListViewDndContext.prototype._getDropOptions=function(){return this._getDndOptions("drop")},t.ListViewDndContext.prototype.IsItemReOrdering=function(){return"enabled"===this._getDndOptions("reorder")},t.ListViewDndContext.prototype.GetDragAffordanceClass=function(){return"oj-listview-drag-handle"},t.ListViewDndContext.prototype.GetDragImageClass=function(){return"oj-listview-drag-image"},t.ListViewDndContext.prototype.GetDragItemClass=function(){return"oj-listview-drag-item"},t.ListViewDndContext.prototype.GetCutStyleClass=function(){return"oj-listview-cut"},t.ListViewDndContext.prototype.GetCommandPrefix=function(){return"oj-listview-"},t.ListViewDndContext.prototype._findItem=function(t){return e(t).get(0).classList.contains("oj-listview-first-drop-target")?e(this.m_dropTargetElem):this.listview.FindItem(t)},t.ListViewDndContext.prototype._getSelectedItems=function(t){var i=[];if(this.listview._isSelectionEnabled())for(var s=this.listview.GetOption("selection"),n=0;n<s.length;n++){var r=this.listview.FindElementByKey(s[n]);null==r||this.listview.SkipFocus(e(r))||i.push(r)}else{var o=this._getActiveItem();null!=o&&i.push(o)}return!t&&null!=this.m_contextMenuItem&&this.m_contextMenuItem.length>0&&(this.listview.element.get(0).contains(this.m_contextMenuItem.get(0))?-1===i.indexOf(this.m_contextMenuItem.get(0))&&(i=[this.m_contextMenuItem.get(0)]):this.m_contextMenuItem=null),i},t.ListViewDndContext.prototype._getActiveItem=function(){return null==this.listview.m_active?null:this.listview.m_active.elem[0]},t.ListViewDndContext.prototype.itemRenderComplete=function(t,i){e(t).hasClass(this.listview.getItemStyleClass())||(t=t.firstElementChild);var s=e(t).find("."+this.GetDragAffordanceClass());if(null!=s&&s.length>0){var n=s.attr("aria-labelledby");null==n?s.attr("aria-labelledby",this.listview._createSubId("instr")):s.attr("aria-labelledby",n+" "+this.listview._createSubId("instr")),this.listview._isTouchSupport()&&s.attr("draggable","true")}},t.ListViewDndContext.prototype._unsetSelectionDraggable=function(){this.m_draggableSelection&&e.each(this.m_draggableSelection,function(t,i){e(i).removeClass("oj-draggable"),this.listview._isTouchSupport()&&e(i).removeAttr("draggable")}.bind(this))},t.ListViewDndContext.prototype.setSelectionDraggable=function(){var t=[];this._unsetSelectionDraggable();for(var i=this.listview.GetOption("selection"),s=0;s<i.length;s++){var n=this.listview.FindElementByKey(i[s]);null==n||this.listview.SkipFocus(e(n))||(t.push(n),e(n).addClass("oj-draggable"),this.listview._isTouchSupport()&&e(n).attr("draggable","true"))}this.m_draggableSelection=t},t.ListViewDndContext.prototype._setItemDraggable=function(t){var e=this.GetDragAffordanceClass(),i=t.find("."+e);return null!=i&&i.length>0||(t.addClass("oj-draggable"),!1)},t.ListViewDndContext.prototype._unsetItemDraggable=function(t){t.removeClass("oj-draggable")},t.ListViewDndContext.prototype._setDraggable=function(t){if(null!=this._getDragOptions()||this.IsItemReOrdering()){var i,s=this.GetDragAffordanceClass();if(t.hasClass(s))i=e(t);else{var n=this._findItem(t);if(this.shouldDragCurrentItem())i=n;else{if(null!=n)if(this._setItemDraggable(n))return;var r=this._getSelectedItems(!0);r.length>0&&(null!=n&&r.indexOf(n[0])>-1?i=n:e(r[0]).removeClass("oj-draggable"))}}null!=i&&i.attr("draggable",!0)}},t.ListViewDndContext.prototype._unsetDraggable=function(t){if(null!=this._getDragOptions()||this.IsItemReOrdering()){var i,s=this.GetDragAffordanceClass();null!=(i=t.hasClass(s)?e(t):this._findItem(t))&&(i.removeAttr("draggable"),this._unsetItemDraggable(i))}},t.ListViewDndContext.prototype.isDndInProgress=function(){return null!=this.m_dragImage},t.ListViewDndContext.prototype._invokeDndCallback=function(t,e,s,n){var r,o="drag"===t?this._getDragOptions():this._getDropOptions();if(o){var a=o[e];if(a&&"function"==typeof a)try{this.listview.ojContext._IsCustomElement()?(a(s.originalEvent,n),s.originalEvent.defaultPrevented&&s.preventDefault()):(s.dataTransfer=s.originalEvent.dataTransfer,r=a(s,n))}catch(t){i.error("Error: "+t)}else r=-1}else r=-1;return r},t.ListViewDndContext.prototype._setDragItemDataTransfer=function(t,e,i){for(var s=[],n=0;n<i.length;n++){var r=this.listview._getDataForItem(i[n]);r&&(r.innerHTML&&r.tagName&&"LI"===r.tagName?s.push(r.innerHTML):s.push(r))}return s.length>0?(this._setDragItemData(t.originalEvent,e,s),this.SetDragItemImage(t.originalEvent,i),{items:s}):null},t.ListViewDndContext.prototype._setDragItemData=function(t,e,i){var s=t.dataTransfer,n=JSON.stringify(i);if("string"==typeof e)s.setData(e,n);else if(e)for(var r=0;r<e.length;r++)s.setData(e[r],n);s.setData(this.GetDragSourceType(),this.listview.element.get(0).id)},t.ListViewDndContext.prototype._createDragImage=function(){var t=document.createElement("ul");if(t.className=this.listview.element.get(0).className,t.classList.add(this.GetDragImageClass()),this.listview.ojContext._IsCustomElement()){var e=["oj-component","oj-complete"].concat(this.listview.GetContainerStyleClass().split(" "));this.listview.GetRootElement().get(0).classList.forEach(function(i){-1===e.indexOf(i)&&t.classList.add(i)})}return t},t.ListViewDndContext.prototype._calculateOffset=function(t){var e=window.getComputedStyle(t);return parseFloat(e.marginLeft)+parseFloat(e.marginRight)+parseFloat(e.paddingLeft)+parseFloat(e.paddingRight)+parseFloat(e.borderLeftWidth)+parseFloat(e.borderRightWidth)},t.ListViewDndContext.prototype._calculateAffordanceOffset=function(t,e){if(null==this.m_cachedOffset){this.m_cachedOffset=Math.max(0,e.offsetLeft-t.offsetLeft)+e.offsetWidth/2;var i=this._calculateOffset(t),s=this._calculateOffset(this.listview.getListContainer().get(0));this.m_cachedOffset+=Math.max(s,i-s)}return this.m_cachedOffset},t.ListViewDndContext.prototype.SetDragItemImage=function(t,i){var s,n,r,o=0,a=0,l=t.target,d=this.listview.isCardLayout();if(i.length>1){var h;(s=e(this._createDragImage())).css({width:this.listview.element.css("width"),height:this.listview.element.css("height")});var m=Number.MAX_VALUE;for(h=0;h<i.length;h++)m=Math.min(m,i[h].offsetTop);for(h=0;h<i.length;h++){n=i[h].offsetTop-m;var p=i[h].offsetWidth;(r=e(i[h].cloneNode(!0))).removeClass("oj-selected oj-focus oj-hover").css({position:"absolute",top:n,width:p}),d||r.addClass("oj-listview-item-drag-image"),s.append(r)}}else e(l).hasClass(this.GetDragAffordanceClass())?(n=0,e.contains(i[0],l.offsetParent)&&(n=l.offsetTop),o=this._calculateAffordanceOffset(i[0],l),a=n+l.offsetHeight/2):(o=Math.max(0,t.offsetX),a=Math.max(0,t.offsetY)),(r=e(i[0].cloneNode(!0))).removeClass("oj-selected oj-focus oj-hover").addClass("oj-drag"),d||r.addClass("oj-listview-item-drag-image"),(s=e(this._createDragImage())).css({width:this.GetDragImageWidth(i[0]),height:2*i[0].offsetHeight}).append(r);d&&s.addClass("oj-listview-card-layout"),e("body").append(s),this.m_dragImage=s,t.dataTransfer.setDragImage(s.get(0),o,a)},t.ListViewDndContext.prototype.GetDragImageWidth=function(){return this.listview.element.css("width")},t.ListViewDndContext.prototype.GetDefaultDataType=function(){return"text/ojlistview-items-data"},t.ListViewDndContext.prototype._handleDragStart=function(t){var i,s,n=this._getDragOptions();if((null!=n||this.IsItemReOrdering())&&(i=null!=n?n.dataTypes:this.GetDefaultDataType(),e(t.target).hasClass(this.GetDragAffordanceClass())||this.shouldDragCurrentItem()?(s=[]).push(this._findItem(t.target)[0]):s=this._getSelectedItems(!0),s.length>0)){this.m_dragItems=s,this.m_currentDragItem=e(s[0]);var r=this._setDragItemDataTransfer(t,i,s);if(r){var o=this._invokeDndCallback("drag","dragStart",t,r);if(-1===o)return;return o}return!1}},t.ListViewDndContext.prototype._handleDrag=function(t){return this._invokeDndCallback("drag","drag",t)},t.ListViewDndContext.prototype._destroyDragImage=function(){null!=this.m_dragImage&&(this.m_dragImage.remove(),this.m_dragImage=null)},t.ListViewDndContext.prototype._handleDragEnd=function(t){if(null!=this.m_currentDragItem&&null!=this.m_dragItems){this.m_currentDragItem.find("."+this.GetDragAffordanceClass()).removeAttr("draggable"),this.m_currentDragItem.removeClass("oj-drag oj-draggable").removeAttr("draggable");for(var i=0;i<this.m_dragItems.length;i++){var s=this.m_dragItems[i];s.classList.remove("oj-listview-drag-source"),s.classList.remove(this.GetDragItemClass()),e(s).css("display","")}}this._cleanupDropTarget(),this._destroyDragImage(),this._unsetSelectionDraggable(),this._invokeDndCallback("drag","dragEnd",t),this.m_itemsDragged=this.m_dragItems,this.m_dragImage=null,this.m_currentDragItem=null,this.m_dragItems=null,this.listview._doBlur()},t.ListViewDndContext.prototype._matchDragDataType=function(t){var e=this._getDropOptions();if(e&&e.dataTypes)for(var i=e.dataTypes,s="string"==typeof i?[i]:i,n=t.originalEvent.dataTransfer.types,r=0;r<n.length;r++)if(s.indexOf(n[r])>=0)return!0;return!1},t.ListViewDndContext.prototype._invokeDropCallback=function(t,e,i){var s=this._invokeDndCallback("drop",t,e,i);return void 0!==s&&-1!==s||this._matchDragDataType(e)&&e.preventDefault(),s},t.ListViewDndContext.prototype._getDropIndicator=function(){return null!=this.m_dragItems?"space":"line"},t.ListViewDndContext.prototype._createDropTarget=function(t){var i,s=this._getDropIndicator();null==this.m_dropTarget&&("space"===s?(i=e(t.get(0).cloneNode(!1))).addClass("oj-drop").removeClass("oj-drag oj-draggable oj-hover oj-focus").css({display:"block",height:t.outerHeight(),width:t.outerWidth()}):"line"===s&&(i=document.createElement("li")).classList.add("oj-listview-drop-target"),this.m_dropTarget=e(i));if("line"===s){var n=t.get(0);n.classList.add("oj-drop"),null!=this.m_dropTargetElem&&this.m_dropTargetElem.classList.remove("oj-drop"),this.m_dropTargetElem=n;var r=n.offsetTop+n.offsetHeight-this._getDropIndicatorHeight();null==t.get(0).nextElementSibling&&this.listview._isGridlinesVisible()&&(r-=1),this.m_dropTarget.get(0).style.top=r+"px"}return this.m_dropTarget},t.ListViewDndContext.prototype._getDropIndicatorHeight=function(){if(!isNaN(this.m_dropIndicatorHeight))return this.m_dropIndicatorHeight;if(this.m_dropTarget){var t=this.m_dropTarget.get(0);return this.listview.element.get(0).appendChild(t),this.m_dropIndicatorHeight=t.offsetHeight,this.listview._isGridlinesVisible()&&(this.m_dropIndicatorHeight-=1),this.m_dropIndicatorHeight}return 0},t.ListViewDndContext.prototype._cleanupGroupItem=function(){null!=this.m_currentDropItem&&-1===this.m_dropTargetIndex&&this.m_currentDropItem.children("."+this.listview.getGroupItemStyleClass()).removeClass("oj-drop")},t.ListViewDndContext.prototype._cleanupEmptyList=function(){null!=this.m_currentDropItem&&this.m_currentDropItem.hasClass(this.listview.getEmptyTextStyleClass())&&(this.m_currentDropItem.removeClass("oj-drop"),this.m_currentDropItem.get(0).textContent=this.listview._getEmptyText())},t.ListViewDndContext.prototype._cleanupDropTarget=function(){null!=this.m_dropTarget&&(this.m_dropTarget.css("height","0"),this.m_dropTarget.remove(),this.m_dropTarget=null),null!=this.m_dropTargetElem&&this.m_dropTargetElem.classList.remove("oj-drop"),null!=this.m_firstDropTarget&&(this.m_firstDropTarget.parentNode.removeChild(this.m_firstDropTarget),this.m_firstDropTarget=null),this._cleanupEmptyList(),this._cleanupGroupItem()},t.ListViewDndContext.prototype._handleDragEnter=function(t){var e=this._findItem(t.target);if(null!=e&&e.length>0){var i=this._invokeDropCallback("dragEnter",t,{item:e.get(0)});if(-1!==i)return i}},t.ListViewDndContext.prototype._setCurrentDropItem=function(t){null!=this.m_currentDropItem&&this.m_currentDropItem.removeClass("oj-valid-drop oj-invalid-drop"),this.m_currentDropItem=t,this.m_currentDropItem.addClass("oj-valid-drop")},t.ListViewDndContext.prototype._setAccInfo=function(t,e){var i=t.attr("aria-label");null==i&&(i=t.text());var s="accessibleReorder"+e.charAt(0).toUpperCase()+e.substr(1)+"Item",n=this.listview.ojContext.getTranslatedString(s,{item:i});this.listview._setAccInfoText(n)},t.ListViewDndContext.prototype._adjustGroupItemStyle=function(){null==this.m_maxHeightAdjusted&&this.listview._isTouchSupport()&&(this.listview.element.find("ul."+this.listview.getGroupStyleClass()).each(function(){e(this).attr("oldMaxHeight",e(this).css("maxHeight").toString()),e(this).css("maxHeight",1e4)}),this.m_maxHeightAdjusted="adjusted")},t.ListViewDndContext.prototype._restoreGroupItemStyle=function(){this.listview._isTouchSupport()&&this.listview.element.find("ul."+this.listview.getGroupStyleClass()).each(function(){e(this).css("maxHeight",parseInt(e(this).attr("oldMaxHeight"),10)),e(this).removeAttr("oldMaxHeight")}),this.m_maxHeightAdjusted=null},t.ListViewDndContext.prototype._setDropPosition=function(t,e){if("line"===this._getDropIndicator())return e.insertAfter(t),"after";var i=t.index();return null==this.m_dropTargetIndex||this.m_dropTargetIndex<i?(e.insertAfter(t),"after"):(e.insertBefore(t),"before")},t.ListViewDndContext.prototype._checkFirstItemDropTarget=function(t,e,i){if(i.classList.contains("oj-listview-first-drop-target"))return this.m_dropPosition="before",void(e.style.top="0px");if("line"===this._getDropIndicator())if(null===t.previousElementSibling)if(null==this.m_firstDropTarget){var s=document.createElement("li");s.classList.add("oj-listview-first-drop-target"),s.style.top="0px",t.parentNode.appendChild(s),this.m_firstDropTarget=s}else this.m_dropPosition="after",e.style.top=t.offsetTop+t.offsetHeight-this._getDropIndicatorHeight()+"px";else this.m_firstDropTarget&&(this.m_firstDropTarget.parentNode.removeChild(this.m_firstDropTarget),this.m_firstDropTarget=null)},t.ListViewDndContext.prototype._handleDragOver=function(t){var i,s,n;if(this._adjustGroupItemStyle(),null!=this.m_dragItems&&"none"!==e(this.m_dragItems[0]).css("display"))if(i=e(this.m_dragItems[0]),-1===(n=this._invokeDropCallback("dragOver",t,{item:i.get(0)}))&&this.IsItemReOrdering()&&this.isDndInProgress()||!1===n||t.isDefaultPrevented()){s=this._createDropTarget(i);for(var r=0;r<this.m_dragItems.length;r++)e(this.m_dragItems[r]).addClass(this.GetDragItemClass()).css("display","none");s.insertBefore(i),this.m_dropTargetIndex=s.index()}else i.get(0).classList.remove("oj-hover"),i.get(0).classList.add("oj-listview-drag-source");else if(null!=(i=this._findItem(t.target))&&i.length>0)-1===(n=this._invokeDropCallback("dragOver",t,{item:i.get(0)}))&&this.IsItemReOrdering()&&this.isDndInProgress()||!1===n||t.isDefaultPrevented()?(i.hasClass(this.listview.getItemStyleClass())?(this._cleanupGroupItem(),i.hasClass("oj-drop")?s=this.m_dropTarget:(s=this._createDropTarget(i),this.m_dropPosition=this._setDropPosition(i,s),this._setAccInfo(i,this.m_dropPosition),this._setCurrentDropItem(i),this.m_dropTargetIndex=s.index()),this._checkFirstItemDropTarget(i.get(0),s.get(0),t.target)):(this._cleanupDropTarget(),i.children("."+this.listview.getGroupItemStyleClass()).addClass("oj-drop"),this._setCurrentDropItem(i),this.m_dropTargetIndex=-1,this.m_dropPosition="inside",this._setAccInfo(i,this.m_dropPosition)),t.preventDefault()):e(t.target).hasClass(this.listview.getGroupStyleClass())||(i.addClass("oj-invalid-drop"),this._cleanupDropTarget());else{var o=this._getAndUpdateEmptyItem();null!=o&&o.length>0&&(this._setCurrentDropItem(o),t.preventDefault())}return n},t.ListViewDndContext.prototype._getAndUpdateEmptyItem=function(){var t=this.listview.element.children("."+this.listview.getEmptyTextStyleClass());return 0===t.length?t=e(this.listview.element[0].querySelector(".oj-listview-no-data-item")):t.get(0).textContent="",t.addClass("oj-drop"),t},t.ListViewDndContext.prototype._isDndEventInElement=function(t,e){var i=e.getBoundingClientRect(),s=t.originalEvent;return s.clientX>=i.left&&s.clientX<i.right&&s.clientY>=i.top&&s.clientY<i.bottom},t.ListViewDndContext.prototype._handleDragLeave=function(t){var e;if(null!=this.m_currentDropItem){var i=this._findItem(t.target);return null!=i&&i.length>0?(i.removeClass("oj-valid-drop oj-invalid-drop"),e=this._invokeDropCallback("dragLeave",t,{item:i.get(0)}),!this._isDndEventInElement(t,t.currentTarget)&&i.hasClass("oj-drop")&&(this._cleanupDropTarget(),this._restoreGroupItemStyle())):this._isDndEventInElement(t,t.currentTarget)||this._cleanupEmptyList(),-1!==e?e:void 0}},t.ListViewDndContext.prototype._isEmptyItem=function(t){return t.hasClass(this.listview.getEmptyTextStyleClass())||t.hasClass("oj-listview-no-data-item")},t.ListViewDndContext.prototype._handleDrop=function(t){if(null!=this.m_currentDropItem){var e,i=t.originalEvent.dataTransfer.getData(this.GetDragSourceType());e=this._isEmptyItem(this.m_currentDropItem)?{}:{item:this.m_currentDropItem.get(0),position:this.m_dropPosition},this.IsItemReOrdering()&&i===this.listview.element.get(0).id?e.reorder=!0:e.reorder=!1,null!=this.m_currentDropItem&&this.m_currentDropItem.removeClass("oj-valid-drop"),this._cleanupDropTarget(),this._restoreGroupItemStyle(),this._destroyDragImage();var s=this._invokeDropCallback("drop",t,e);if(e.reorder&&(e.items=null==this.m_dragItems?this.m_itemsDragged:this.m_dragItems,this.listview.Trigger("reorder",t,this.CreateReorderPayload(e.items,e.position,e.item)),t.preventDefault()),this.m_currentDropItem=null,this.m_dropTargetIndex=-1,this.m_dropPosition=null,this.m_itemsDragged=null,-1!==s)return s}},t.ListViewDndContext.prototype.CreateReorderPayload=function(t,e,i){return{items:t,position:e,reference:i}},t.ListViewDndContext.prototype.prepareContextMenu=function(t){var i=this;if(this.IsItemReOrdering()){var s=e(t);this.m_contextMenu!==t&&(this.m_contextMenu=t,"OJ-MENU"===t.tagName?(t.addEventListener("ojBeforeOpen",this._handleContextMenuBeforeOpen.bind(this)),t.addEventListener("ojAction",this._handleContextMenuSelect.bind(this))):(s.on("ojbeforeopen",this._handleContextMenuBeforeOpen.bind(this)),s.on("ojselect",this._handleContextMenuSelect.bind(this))));var n=this._getCommands(t,function(t,s){var n=i._buildContextMenuItem(s,t.tagName);"OJ-OPTION"===t.tagName?(t.innerHTML=n.get(0).innerHTML,e(t).attr("data-oj-command",n.attr("data-oj-command"))):(n.get(0).className=e(t).get(0).className,e(t).replaceWith(n))});this.m_menuItemsSet=n,n.length>0&&s.data("oj-ojMenu")&&("OJ-MENU"===t.tagName?t.refresh():e(t).ojMenu("refresh"))}},t.ListViewDndContext.prototype._getDndContextMenuItemSelector=function(){var t=this,e="",i=["cut","copy","paste","paste-before","paste-after","pasteBefore","pasteAfter"];return this.m_dndMenuItemSelector||(i.forEach(function(s,n){e+="[data-oj-command="+t.GetCommandPrefix()+s+"],",e+="[data-oj-command="+s+"]",n<i.length-1&&(e+=",")}),this.m_dndMenuItemSelector=e),this.m_dndMenuItemSelector},t.ListViewDndContext.prototype._getCommands=function(i,s){var n=this,r=[];return e(i).find(this._getDndContextMenuItemSelector()).each(function(){var i;0===e(this).children("a").length?0===e(this).attr("data-oj-command").indexOf(n.GetCommandPrefix())&&(i=e(this).attr("data-oj-command").substring(n.GetCommandPrefix().length),s&&s(this,i)):(i=e(this).attr("data-oj-command"))===t.ListViewDndContext.PASTE_BEFORE_COMMAND?i="paste-before":i===t.ListViewDndContext.PASTE_AFTER_COMMAND&&(i="paste-after"),i&&r.push(i)}),r},t.ListViewDndContext.prototype._buildContextMenuItem=function(e,i){return"paste-before"===e?this._buildContextMenuListItem(t.ListViewDndContext.PASTE_BEFORE_COMMAND,i):"paste-after"===e?this._buildContextMenuListItem(t.ListViewDndContext.PASTE_AFTER_COMMAND,i):this._buildContextMenuListItem(e,i)},t.ListViewDndContext.prototype._buildContextMenuListItem=function(t,i){var s=e(document.createElement(i));return s.attr("data-oj-command",t),s.append(this._buildContextMenuLabel(t,"OJ-OPTION"===i)),s},t.ListViewDndContext.prototype._buildContextMenuLabel=function(t,i){var s="label"+t.charAt(0).toUpperCase()+t.slice(1),n=document.createTextNode(this.listview.ojContext.getTranslatedString(s));return i?n:e('<a href="#"></a>').append(n)},t.ListViewDndContext.prototype._handleCut=function(t){null!=this.m_clipboard&&e(this.m_clipboard).removeClass(this.GetCutStyleClass());var i=this.GetCutItems(t);this.listview.ojContext.element.focus(),e(i).addClass(this.GetCutStyleClass()),this.m_clipboard=i,this.listview.Trigger("cut",t,{items:i})},t.ListViewDndContext.prototype.GetCutItems=function(t){return this._getSelectedItems()},t.ListViewDndContext.prototype._handleCopy=function(t){null!=this.m_clipboard&&e(this.m_clipboard).removeClass(this.GetCutStyleClass());var i=this._getSelectedItems();this.m_clipboard=i,this.listview.Trigger("copy",t,{items:i})},t.ListViewDndContext.prototype._handlePaste=function(t,i,s){this.listview.Trigger("paste",t,{item:i.get(0)}),e(this.m_clipboard).removeClass(this.GetCutStyleClass()),this.listview.Trigger("reorder",t,this.CreateReorderPayload(this.m_clipboard,s,i.get(0))),this.m_clipboard=null},t.ListViewDndContext.prototype._handleContextMenuSelect=function(i,s){if(null!=this.m_contextMenuItem)switch((s?s.item:e(i.target)).attr("data-oj-command")){case t.ListViewDndContext.CUT_COMMAND:this._handleCut(i);break;case t.ListViewDndContext.COPY_COMMAND:this._handleCopy(i);break;case t.ListViewDndContext.PASTE_COMMAND:this._handlePaste(i,this.m_contextMenuItem,"inside"),this.m_contextMenuItem=null;break;case t.ListViewDndContext.PASTE_BEFORE_COMMAND:this._handlePaste(i,this.m_contextMenuItem,"before"),this.m_contextMenuItem=null;break;case t.ListViewDndContext.PASTE_AFTER_COMMAND:this._handlePaste(i,this.m_contextMenuItem,"after"),this.m_contextMenuItem=null}},t.ListViewDndContext.prototype._appendToMenuContainer=function(e,i){null!=this.m_menuItemsSet&&("paste-before"===i?i=t.ListViewDndContext.PASTE_BEFORE_COMMAND:"paste-after"===i&&(i=t.ListViewDndContext.PASTE_AFTER_COMMAND),e.find("[data-oj-command='"+i+"']").removeClass("oj-disabled"))},t.ListViewDndContext.prototype._handleContextMenuBeforeOpen=function(t,i){var s=e(t.target);s.find(this._getDndContextMenuItemSelector()).addClass("oj-disabled");var n=i?i.openOptions.launcher:t.detail.openOptions.launcher;null!=n&&null!=this.m_menuItemsSet&&0!==this.m_menuItemsSet.length?(n.children().first().hasClass(this.listview.getGroupItemStyleClass())?null!=this.m_clipboard&&this._appendToMenuContainer(s,"paste"):(this._appendToMenuContainer(s,"cut"),this._appendToMenuContainer(s,"copy"),null!=this.m_clipboard&&(this._appendToMenuContainer(s,"paste-before"),this._appendToMenuContainer(s,"paste-after"))),"OJ-MENU"!==s.get(0).tagName&&s.ojMenu("refresh"),this.m_contextMenuItem=n):"OJ-MENU"!==s.get(0).tagName&&s.ojMenu("refresh")},t.ListViewDndContext.prototype.HandleKeyDown=function(i){if(i.ctrlKey||i.metaKey){var s=i.keyCode;if(s===t.ListViewDndContext.X_KEY||s===t.ListViewDndContext.C_KEY||t.ListViewDndContext.V_KEY){if(!this.IsItemReOrdering())return!1;var n=this.listview.ojContext._GetContextMenu();if(null==n)return!1;var r=this._getCommands(n);if(0===r.length)return!1;if(s===t.ListViewDndContext.X_KEY&&r.indexOf("cut")>-1)return this._handleCut(i),!0;if(s===t.ListViewDndContext.C_KEY&&r.indexOf("copy")>-1)return this._handleCopy(i),!0;if(s===t.ListViewDndContext.V_KEY&&null!=this.m_clipboard){var o,a=e(this._getActiveItem());if(a.children().first().hasClass(this.listview.getGroupItemStyleClass())?r.indexOf("paste")>-1&&(o="inside"):r.indexOf("paste-before")>-1?o="before":r.indexOf("paste-after")>-1&&(o="after"),null!=o)return this._handlePaste(i,a,o),!0}}}return!1},t.ListViewDndContext.prototype.shouldDragCurrentItem=function(){return!1},t.ListViewDndContext.prototype.GetDragSourceType=function(){return"text/ojlistview-dragsource-id"}});