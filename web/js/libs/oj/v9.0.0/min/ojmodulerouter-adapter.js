/**
 * @license
 * Copyright (c) 2014, 2020, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["knockout","ojs/ojmodule-element-utils","ojs/ojmoduleanimations","ojs/ojlogger"],function(e,t,n,i){"use strict";return function(r,a){var o=r,l=a||{},u=null,s=null,c=null,v=e.observable({view:[],viewModel:null});function d(e){return e?l.pathKey?e.detail[l.pathKey]:e.path:null}var f,m=l.animationCallback?(f=function(e){var t={node:e.node,previousViewModel:e.oldViewModel,viewModel:e.newViewModel,previousState:u,state:s};return l.animationCallback(t)},new function(){var e;function t(t){return function(n){return e[t].call(e,n)}}this.canAnimate=function(i){var r=f(i);return!!(e="string"==typeof r?n[r]:r)&&(["prepareAnimation","animate"].forEach(function(e){this[e]=t(e)}.bind(this)),t("canAnimate")(i))}.bind(this)}):null;o.beforeStateChange.subscribe(function(e){var t=v().viewModel,n=t&&t.canExit?t.canExit():Promise.resolve();e.accept(n)}),o.currentState.subscribe(function(e){var n,r=d(e?e.state:null);if(r){if(r===d(s)&&v().viewModel&&v().viewModel.parametersChanged)return v().viewModel.parametersChanged(e.state.params),void(s=e.state);var a=l.viewPath||"views/",f=l.viewModelPath||"viewModels/";n=t.createConfig({require:l.require,viewPath:a+r+".html",viewModelPath:f+r,params:{parentRouter:o,params:e.state.params,router:o,routerState:e.state}})}else n=Promise.resolve({view:[],viewModel:null});e.complete(n),c=n,n.then(function(t){c===n&&(u=s,s=e.state,v(t))},function(e){i.error("Error creating oj-module config : ",e)})});var w={};return Object.defineProperties(w,{koObservableConfig:{get:function(){return v}},animation:{get:function(){return m}}}),w}});