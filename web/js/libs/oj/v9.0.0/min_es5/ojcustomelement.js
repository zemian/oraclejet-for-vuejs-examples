/**
 * @license
 * Copyright (c) 2014, 2020, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["ojs/ojcore","require","ojs/ojlogger","ojs/ojcontext","ojs/ojmetadatautils","customElements"],function(e,t,r,n,i){"use strict";function o(e){"@babel/helpers - typeof";return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.BaseCustomElementBridge={},e.BaseCustomElementBridge.proto={getClass:function(t){var r=Object.create(HTMLElement.prototype);this.InitializePrototype(r);var n=this.GetMetadata(t);e.BaseCustomElementBridge._enumerateMetadataForKey(r,n,"properties",this.DefinePropertyCallback.bind(this)),e.BaseCustomElementBridge._enumerateMetadataForKey(r,n,"methods",this.DefineMethodCallback.bind(this)),this.AddComponentMethods(r),r.setProperties=function(t){e.BaseCustomElementBridge.getInstance(this)._setProperties(this,t)},Object.defineProperty(r,"set",{value:function(e,t){this.setProperty(e,t)}}),Object.defineProperty(r,"unset",{value:function(e){this.setProperty(e,void 0)}}),r.attributeChangedCallback=this.AttributeChangedCallback,r.connectedCallback=this._connectedCallback,r.disconnectedCallback=this._detachedCallback;var i=function(){var e=window.Reflect;return void 0!==e?e.construct(HTMLElement,[],this.constructor):HTMLElement.call(this)},o=this;return Object.defineProperty(i,"observedAttributes",{get:function(){return o.GetAttributes(n)}}),Object.defineProperty(r,"constructor",{value:i,writable:!0,configurable:!0}),i.prototype=r,Object.setPrototypeOf(i,HTMLElement),i},playbackEarlyPropertySets:function(e){this._bCanSetProperty=!0,this.PlaybackEarlyPropertySets(e)},resolveBindingProvider:function(e){this._bpResolve?this._bpResolve(e):this._bpInst=e},disposeBindingProvider:function(e){this._bDisposed=!0,!this._complete&&this._bConnected&&this._resolveBusyState(e)},resolveDelayedReadyPromise:function(){this.GetDelayedReadyPromise().resolvePromise()},whenCreated:function(){return this._whenCreatedPromise},AddComponentMethods:function(e){},AttributeChangedCallback:function(t,n,i){if(n!==i){var o=e.BaseCustomElementBridge.getInstance(this);if("disabled"===t&&o.ShouldRemoveDisabled()&&o._isDisabledAttributeRemoved())return void(null!=i&&(r.warn("Ignoring 'disabled' attribute change after component initialization. Use element property setter instead."),o._removeDisabledAttribute(this)));if(o.ShouldHandleAttributeChanged(this)){var s=e.__AttributeUtils.attributeToPropertyName(t),a=e.BaseCustomElementBridge.__GetPropertyMetadata(s,e.BaseCustomElementBridge.getProperties(o));e.BaseCustomElementBridge.__CheckOverlappingAttribute(this,t),null===i&&(i=void 0);var l={detail:{attribute:t,value:i,previousValue:n}};this.dispatchEvent(new CustomEvent("attribute-changed",l)),e.__AttributeUtils.getExpressionInfo(i).expr||(a&&this.setProperty(s,e.BaseCustomElementBridge.__ParseAttrValue(this,t,s,i,a)),o.HandleAttributeChanged(this,t,n,i))}}},CreateComponent:function(e){},DefineMethodCallback:function(e,t,r){},DefinePropertyCallback:function(e,t,r){},GetDelayedReadyPromise:function(){return this._delayedReady||(this._delayedReady=new e.BaseCustomElementBridge.__DelayedPromise),this._delayedReady},GetAttributes:function(t){return t?e.BaseCustomElementBridge.getAttributes(t.properties):[]},GetMetadata:function(t){return t[e.BaseCustomElementBridge.DESC_KEY_META]||{}},GetAliasForProperty:function(e){return e},GetTrackChildrenOption:function(e){return this.METADATA.extension&&this.METADATA.extension._TRACK_CHILDREN?this.METADATA.extension._TRACK_CHILDREN:"none"},ShouldHandleAttributeChanged:function(e){return this._bCreateCalled},ShouldCallHandleAttributeChanged:function(e){return this.ShouldHandleAttributeChanged()},HandleAttributeChanged:function(e,t,r,n){},HandleBindingsApplied:function(e,t){},HandleDetached:function(e){},HandleReattached:function(e){},InitializeElement:function(e){},InitializePrototype:function(e){},BatchedPropertySet:function(e,t){for(var r=Object.keys(t),n=0;n<r.length;n++){var i=r[n];e.setProperty(i,t[i])}},GetEventListenerProperty:function(t){var r=e.__AttributeUtils.eventListenerPropertyToEventType(t),n=this._eventListeners[r];if(n)return n.getListener()},GetProperty:function(t,r,n){var i=e.__AttributeUtils.eventListenerPropertyToEventType(r),o=e.BaseCustomElementBridge.__GetPropertyMetadata(r,e.BaseCustomElementBridge.getProperties(this));return i||!o||-1===r.indexOf(".")?n[r]:e.BaseCustomElementBridge.__GetProperty(n,r)},InitializeBridge:function(e,t){this.METADATA=this.GetMetadata(t),this._eventListeners={}},PlaybackEarlyPropertySets:function(e){if(this._earlySets)for(;this._earlySets.length;){var t=this._earlySets.shift();e.setProperty(t.property,t.value)}},SaveEarlyPropertySet:function(e,t){return!this.__INITIALIZING_PROPS&&!this._bCanSetProperty&&(this._earlySets||(this._earlySets=[]),this._earlySets.push({property:e,value:t}),!0)},SetEventListenerProperty:function(t,r,n){var i=e.__AttributeUtils.eventListenerPropertyToEventType(r),o=this._eventListeners[i];o||(o=this._createEventListenerWrapper(),this._eventListeners[i]=o,t.addEventListener(i,o)),null==n||n instanceof Function?o.setListener(n):e.BaseCustomElementBridge.__ThrowTypeError(t,r,n,"function")},SetProperty:function(t,r,n,i,o){var s=e.__AttributeUtils.eventListenerPropertyToEventType(r),a=e.BaseCustomElementBridge.__GetPropertyMetadata(r,e.BaseCustomElementBridge.getProperties(this));if(s||!a)t[r]=n;else{var l=t.getProperty(r),u=r.split(".")[0],d=i[u];if(e.CollectionUtils.isPlainObject(d)&&(d=e.CollectionUtils.copyInto({},d,void 0,!0)),!e.BaseCustomElementBridge.__CompareOptionValues(r,a,n,l)){var m=-1!==r.indexOf(".");if(m&&(this._SKIP_PROP_CHANGE_EVENT=!0),o?this.ValidateAndSetProperty(this.GetAliasForProperty.bind(this),i,r,n,t):e.BaseCustomElementBridge.__SetProperty(this.GetAliasForProperty.bind(this),i,r,n),this._SKIP_PROP_CHANGE_EVENT=!1,m){var c={};c.path=r,c.value=n,c.previousValue=l;var g=o?"external":"internal";e.BaseCustomElementBridge.__FirePropertyChangeEvent(t,u,i[u],d,g,c)}return{property:u,propertySet:!0,isSubproperty:m}}}return{property:null,propertySet:!1,isSubproperty:!1}},ShouldRemoveDisabled:function(){return!0},ValidateAndSetProperty:function(t,r,n,i,o){var s=this.ValidatePropertySet(o,n,i);e.BaseCustomElementBridge.__SetProperty(t,r,n,s)},ValidatePropertySet:function(t,n,i){var o=e.BaseCustomElementBridge.getProperties(this),s=e.BaseCustomElementBridge.__GetPropertyMetadata(n,o),a=n.split(".");if(s)return o[a[0]].readOnly&&this.throwError(t,"Read-only property '"+n+"' cannot be set."),e.BaseCustomElementBridge.checkEnumValues(t,n,i,s),null!=i?e.BaseCustomElementBridge.checkType(t,n,i,s):i;r.warn(e.BaseCustomElementBridge.getElementInfo(t)+": Ignoring property set for undefined property '"+n+"'.")},GetPreCreatePromise:function(t){var r=this._getBindingProvider(t);return"none"!==e.BaseCustomElementBridge.getTrackChildrenOption(t)&&(r=r.then(function(e){return this._whenChildrenCreated(t,e)}.bind(this))),r},PostCreate:function(e){e.hasAttribute("disabled")&&this.ShouldRemoveDisabled()&&!this._isDisabledAttributeRemoved()&&this._removeDisabledAttribute(e)},_connected:function(e){if(this._bConnected=!0,this._bCreateCalled)this._complete?this.HandleReattached(e):this._registerBusyState(e);else{this._bCreateCalled=!0,this._registerBusyState(e),this._monitorReadyPromise(e),this.InitializeElement(e);var t=this;this._whenCreatedPromise=this.GetPreCreatePromise(e).then(function(){try{t._bDisposed?t._bCreateCalled=!1:(t.CreateComponent(e),t.PostCreate(e))}catch(r){t.throwError(e,"Error while rendering component.",r)}})}},_connectedCallback:function(){e.BaseCustomElementBridge.getInstance(this)._connected(this)},_detachedCallback:function(){var t=e.BaseCustomElementBridge.getInstance(this);t._bConnected=!1,t._complete?t.HandleDetached(this):t._bDisposed||t._resolveBusyState(this)},_createEventListenerWrapper:function(){var e,t=function(t){e&&e(t)};return t.setListener=function(t){e=t},t.getListener=function(){return e},t},_monitorReadyPromise:function(e){var t=this,r=function(){!t._complete&&t._bConnected&&(t._resolveBusyState(e),t._complete=!0)};this.GetDelayedReadyPromise().getPromise().then(function(){e.classList.add("oj-complete"),r()},function(){e.classList.add("oj-incomplete"),r()})},_registerBusyState:function(t){var r=n.getContext(t).getBusyContext();this._initCompleteCallback=r.addBusyState({description:e.BaseCustomElementBridge.getElementInfo(t)+" is being upgraded."})},_resolveBusyState:function(e){var t=this._initCompleteCallback;t||this.throwError(e,"Unexpected call to _resolveBusyState()."),this._initCompleteCallback=null,t()},_setProperties:function(e,t){for(var r=[],n={},i=!1,o=Object.keys(t),s=0;s<o.length;s++){var a=o[s];a.indexOf(".")>=0?r.push(a):(n[a]=t[a],i=!0)}i&&this.BatchedPropertySet(e,n);for(var l=0;l<r.length;l++){var u=r[l];e.setProperty(u,t[u])}},throwError:function(t,r,n){this.GetDelayedReadyPromise().rejectPromise();var i=e.BaseCustomElementBridge.getElementInfo(t)+": "+r;throw n&&(i=i+" "+(n.stack?n.stack:n)),new Error(i)},_setBpResolver:function(e){this._bpResolve=e},_getBindingProvider:function(t){var r=this._getBindingProviderName(t);return r===e.BaseCustomElementBridge._NO_BINDING_PROVIDER?(this.playbackEarlyPropertySets(t),Promise.resolve(null)):"knockout"===r?this._bpInst?Promise.resolve(this._bpInst):new Promise(this._setBpResolver.bind(this)):void this.throwError(t,"Unknown binding provider '"+r+"'.")},_getBindingProviderName:function(t){var r=t._ojBndgPrv;if(r)return r;if(!(r=t.getAttribute("data-oj-binding-provider")||e.BaseCustomElementBridge._getCompositeBindingProviderName(t))){var n=t.parentElement;null==n?t===document.documentElement?r="knockout":this.throwError(t,"Cannot determine binding provider for a disconnected subtree."):r=n._vcomp?e.BaseCustomElementBridge._NO_BINDING_PROVIDER:this._getBindingProviderName(n)}return Object.defineProperty(t,"_ojBndgPrv",{value:r}),r},_getChildrenToTrack:function(t,r,n){for(var i=t.childNodes,o=0;o<i.length;o++){var s=i[o];e.ElementUtils.isValidCustomElementName(s.localName)?n.push(s):"nearestCustomElement"===r&&this._getChildrenToTrack(s,r,n)}return n},_whenChildrenCreated:function(t,i){var o=e.BaseCustomElementBridge.getTrackChildrenOption(t),s=n.getContext(t).getBusyContext(),a=this._getChildrenToTrack(t,o,[]).map(function(t){if(!i){var n=s.addBusyState({description:"Waiting for element "+t.localName+" to be defined."}),o=setInterval(function(){r.warn("Warning: waiting for element "+t.localName+" to be defined.")},2e4);return customElements.whenDefined(t.localName).then(function(){return n(),clearInterval(o),e.BaseCustomElementBridge.getRegistered(t.tagName)?e.BaseCustomElementBridge.getInstance(t).whenCreated():null}).catch(function(e){throw n(),clearInterval(o),new Error("Error defining element "+t.localName+" : "+e)})}return e.BaseCustomElementBridge.getRegistered(t.tagName)?e.BaseCustomElementBridge.getInstance(t).whenCreated():null});return Promise.all(a)},_isDisabledAttributeRemoved:function(){return!0===this._disabledProcessed},_removeDisabledAttribute:function(e){this._disabledProcessed=!0,e.removeAttribute("disabled")}},e.BaseCustomElementBridge.getAttributes=function(t){var r=[];return e.BaseCustomElementBridge._getAttributesFromProperties("",t,r),r},e.BaseCustomElementBridge.getTrackChildrenOption=function(t){var r=e.BaseCustomElementBridge.getInstance(t);return r?r.GetTrackChildrenOption(t):"none"},e.BaseCustomElementBridge._getAttributesFromProperties=function(t,r,n){if(r)for(var i=Object.keys(r),o=0;o<i.length;o++){var s=i[o],a=r[s];if(!a.readOnly){var l=t+s;n.push(e.__AttributeUtils.propertyNameToAttribute(l)),a.properties&&e.BaseCustomElementBridge._getAttributesFromProperties(l+".",a.properties,n)}}},e.BaseCustomElementBridge.getElementInfo=function(e){return e?e.tagName.toLowerCase()+" with id '"+e.id+"'":""},e.BaseCustomElementBridge.getInstance=function(t){var n=t[e.BaseCustomElementBridge._INSTANCE_KEY];if(!n){var i=e.BaseCustomElementBridge._registry[t.tagName.toLowerCase()];i||r.error(e.BaseCustomElementBridge.getElementInfo(t)+" Attempt to interact with the custom element before it has been registered."),n=Object.create(i.bridgeProto);var o=e.BaseCustomElementBridge.__GetDescriptor(t.tagName);n.InitializeBridge(t,o),Object.defineProperty(t,e.BaseCustomElementBridge._INSTANCE_KEY,{value:n})}return n},e.BaseCustomElementBridge.getProperties=function(e){return e.METADATA.properties},e.BaseCustomElementBridge.getRegistered=function(t){if(t){var r=e.BaseCustomElementBridge._registry[t.toLowerCase()];if(r)return{composite:r.composite}}return null},e.BaseCustomElementBridge.getSlotMap=function(t){for(var r={},n=t.childNodes,i=0;i<n.length;i++){var o=n[i];if(e.BaseCustomElementBridge.isSlotable(o)){var s=e.BaseCustomElementBridge.getSlotAssignment(o);r[s]||(r[s]=[]),r[s].push(o)}}return r},e.BaseCustomElementBridge.getSlotAssignment=function(e){var t=null!=e.__oj_slots?e.__oj_slots:e.getAttribute&&e.getAttribute("slot");return t||(t=""),t},e.BaseCustomElementBridge.isSlotable=function(e){return 1===e.nodeType||3===e.nodeType&&e.nodeValue.trim()},e.BaseCustomElementBridge._NO_BINDING_PROVIDER="none",e.BaseCustomElementBridge._enumerateMetadataForKey=function(e,t,r,n){if(t&&t[r]){var i=t[r];Object.keys(i).forEach(function(t){n(e,t,i[t])})}},e.BaseCustomElementBridge._getCompositeBindingProviderName=function(t){return e.Composite?e.Composite.getBindingProviderName(t.parentElement):null},e.BaseCustomElementBridge.checkEnumValues=function(t,r,n,i){if("string"==typeof n&&i){var o=i.enumValues;if(o&&-1===o.indexOf(n))e.BaseCustomElementBridge.getInstance(t).throwError(t,"Invalid value '"+n+"' found for property '"+r+"'. Expected one of the following '"+o.toString()+"'.")}},e.BaseCustomElementBridge.checkType=function(t,r,n,i){var s=i.type;if(s){var a=(s=s.toLowerCase()).split("|"),l=o(n);if(1===a.length)("array"===s.substring(0,5)&&!Array.isArray(n)||"object"===s.substring(0,6)&&"object"!==l||"number"===s&&("number"!=typeof n||!isFinite(n))||"string"===s&&"string"!==l)&&e.BaseCustomElementBridge.__ThrowTypeError(t,r,n,s),"boolean"===s&&(n=!!n);else if(2===a.length){var u,d=a.indexOf("string"),m=a.indexOf("promise");-1!==d&&"string"!==l?("function"===(u=0===d?a[1]:a[0])&&"function"!==l||"array"===u.substring(0,5)&&!Array.isArray(n)||"object"===u.substring(0,6)&&"object"!==l)&&e.BaseCustomElementBridge.__ThrowTypeError(t,r,n,s):-1===m||n instanceof Promise||"array"!==(u=0===m?a[1]:a[0]).substring(0,5)||Array.isArray(n)||e.BaseCustomElementBridge.__ThrowTypeError(t,r,n,s)}}return n},e.BaseCustomElementBridge.__CompareOptionValues=function(t,r,n,i){return r.writeback?e.Object.compareValues(n,i):n===i},e.BaseCustomElementBridge.__ThrowTypeError=function(t,r,n,i){e.BaseCustomElementBridge.getInstance(t).throwError(t,"Invalid type '"+o(n)+"' found for property '"+r+"'. Expected value of type '"+i+"'.")},e.BaseCustomElementBridge.__GetDescriptor=function(t){return e.BaseCustomElementBridge._registry[t.toLowerCase()].descriptor},e.BaseCustomElementBridge.__GetCache=function(t){return t?e.BaseCustomElementBridge._registry[t.toLowerCase()].cache:null},e.BaseCustomElementBridge.__CheckOverlappingAttribute=function(t,r){var n=r.split(".");if(n.length>1)for(n.pop();n.length;){var i=n.join(".");if(t.hasAttribute(i))e.BaseCustomElementBridge.getInstance(t).throwError(t,"Cannot set overlapping attributes '"+r+"' and '"+i+"'.");n.pop()}},e.BaseCustomElementBridge.__GetPropertyMetadata=function(e,t){for(var r=t,n=e.split("."),i=0;i<n.length&&(r=r[n[i]])&&(!(n.length>1&&i<n.length-1)||(r=r.properties));i++);return r},e.BaseCustomElementBridge.__InitProperties=function(t,r){var n=e.BaseCustomElementBridge.getInstance(t);n.__INITIALIZING_PROPS=!0;var i=e.BaseCustomElementBridge.getProperties(n);if(i)for(var o=t.attributes,s=0;s<o.length;s++){var a=o[s],l=e.__AttributeUtils.attributeToPropertyName(a.nodeName),u=e.BaseCustomElementBridge.__GetPropertyMetadata(l,i);if(u&&!u.readOnly)if(e.BaseCustomElementBridge.__CheckOverlappingAttribute(t,a.nodeName),!e.__AttributeUtils.getExpressionInfo(a.value).expr){var d=e.BaseCustomElementBridge.__ParseAttrValue(t,a.nodeName,l,a.value,u);n.ValidateAndSetProperty(n.GetAliasForProperty.bind(n),r,l,d,t)}}n.__INITIALIZING_PROPS=!1},e.BaseCustomElementBridge.__SetProperty=function(e,t,r,n){var i,o=t,s=r.split("."),a=e(s[0]);s.length>1&&!t[a]&&(o=i={});for(var l=0;l<s.length;l++){var u=e(s[l]);l===s.length-1?o[u]=n:o[u]||(o[u]={}),o=o[u]}i&&(t[a]=i[a])},e.BaseCustomElementBridge.__GetProperty=function(e,t){for(var r=e,n=t.split("."),i=0;i<n.length;i++){var o=n[i];if(i===n.length-1)return r[o];if(!r[o])return;r=r[o]}},e.BaseCustomElementBridge.__ParseAttrValue=function(t,r,n,i,o){if(null==i)return i;var s=o.type,a=e.BaseCustomElementBridge.getInstance(t);function l(n){var i;try{i=e.__AttributeUtils.coerceValue(t,r,n,s)}catch(e){a.throwError(t,"Error parsing attribute value.",e)}return i}var u=e.BaseCustomElementBridge.__GetDescriptor(t.tagName).parseFunction;return u?u(i,n,o,function(e){return l(e)}):l(i)},e.BaseCustomElementBridge.__ProcessEventListeners=function(t){var r=e.CollectionUtils.copyInto({},t,void 0,!0,1);return r.properties=r.properties||{},e.BaseCustomElementBridge._enumerateMetadataForKey(null,r,"properties",function(t,n){var i=e.__AttributeUtils.propertyNameToChangeEventType(n),o=e.__AttributeUtils.eventTypeToEventListenerProperty(i);r.properties[o]={_derived:!0,_eventListener:!0}}),e.BaseCustomElementBridge._enumerateMetadataForKey(null,r,"events",function(t,n){var i=e.__AttributeUtils.eventTypeToEventListenerProperty(n);r.properties[i]={_derived:!0,_eventListener:!0}}),r},e.BaseCustomElementBridge.__Register=function(t,n,i,o){var s=t.toLowerCase();return!e.BaseCustomElementBridge._registry[s]&&(n||r.error("Cannot register "+t+". Missing a descriptor."),e.BaseCustomElementBridge._registry[s]={descriptor:n,bridgeProto:i,composite:o,cache:{}},!0)},e.BaseCustomElementBridge.__FirePropertyChangeEvent=function(t,r,n,i,o,s){var a=e.BaseCustomElementBridge.getInstance(t);if(!a._SKIP_PROP_CHANGE_EVENT){var l={};s&&(l.subproperty=s),l.value=n,l.previousValue=i,l.updatedFrom=o,a.beforePropertyChangedEvent&&a.beforePropertyChangedEvent(t,r,l),("external"!==o||a.__READY_TO_FIRE)&&t.dispatchEvent(new CustomEvent(r+"Changed",{detail:l}))}},e.BaseCustomElementBridge.__DefineDynamicObjectProperty=function(e,t,r,n){Object.defineProperty(e,t,{enumerable:!0,get:r,set:n})},e.BaseCustomElementBridge._registry={},e.BaseCustomElementBridge.DESC_KEY_CSS="css",e.BaseCustomElementBridge.DESC_KEY_META="metadata",e.BaseCustomElementBridge.DESC_KEY_PARSE_FUN="parseFunction",e.BaseCustomElementBridge.DESC_KEY_VIEW="view",e.BaseCustomElementBridge.DESC_KEY_VIEW_MODEL="viewModel",e.BaseCustomElementBridge._INSTANCE_KEY="_ojBridge",e.BaseCustomElementBridge.__DelayedPromise=function(){var e,t,r;this.getPromise=function(){return e||(e=new Promise(function(e,n){t=e,r=n})),e},this.rejectPromise=function(e){r&&r(e)},this.resolvePromise=function(e){t&&t(e)}}});