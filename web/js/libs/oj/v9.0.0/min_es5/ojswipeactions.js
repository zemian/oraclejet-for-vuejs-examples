/**
 * @license
 * Copyright (c) 2014, 2020, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["ojs/ojcore","jquery","ojs/ojcontext","ojs/ojconfig","ojs/ojoffcanvas","ojs/ojswipetoreveal","ojs/ojoption","touchr"],function(e,t,n,s,i,o){"use strict";var a={properties:{translations:{type:"object",value:{},properties:{ariaHideActionsDescription:{type:"string"},ariaShowEndActionsDescription:{type:"string"},ariaShowStartActionsDescription:{type:"string"}}}},methods:{refresh:{},setProperty:{},getProperty:{},setProperties:{},getNodeBySubId:{},getSubIdByNode:{}},events:{ojAction:{}},extension:{}};
/**
 * @preserve Copyright 2013 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */e.__registerWidget("oj.ojSwipeActions",t.oj.baseComponent,{version:"1.0.0",defaultElement:"<div>",widgetEventPrefix:"oj",options:{action:null},_ComponentCreate:function(){var e,n=this,s=!1,i=!1,o=!1;this._super(),this.element.uniqueId(),this.element[0].classList.add("oj-swipeactions","oj-component"),this.element[0].setAttribute("tabIndex","-1"),this._touchstartListener=function(t){null!=(e=n.element[0].querySelector(".oj-offcanvas-open"))&&e.offsetWidth>0&&t.preventDefault(),s=!0},this.element[0].addEventListener("touchstart",this._touchstartListener,{passive:!1}),this._on(!0,{touchend:function(e){s&&n._handleAction(e),s=!1},keydown:function(t){27===t.keyCode?(e=t.target.parentNode.parentNode).classList.contains("oj-offcanvas-open")&&(n._close({selector:e,_animate:!1}),t.preventDefault()):13===t.keyCode&&t.target.classList.contains("oj-swipeactions-action-panel")&&(i=!0)},keyup:function(e){13===e.keyCode&&i&&n._handleAction(e),i=!1},mouseup:function(e){this.m_content&&!this.m_content.contains(e.target)&&n._handleAction(e)},click:function(e){this.m_content&&!this.m_content.contains(e.target)&&e.stopPropagation()},ojdefaultaction:function(e,s){var i=t(s.selector).children("oj-option.oj-swipetoreveal-default");i.length>0&&(n._fireActionEvent(i[0],null),o=!0)},ojopen:function(e,t){o&&n._close(t),o=!1,n._releaseBusyState()},ojclose:function(e,s){var i=t(s.selector).children(".oj-swipeactions-hide-actions-link");i.length>0&&i[0].parentNode.removeChild(i[0]),n._releaseBusyState()}}),this._focusable({applyHighlight:!0,setupHandlers:function(e,t){n._focusInHandler=e,n._focusOutHandler=t}}),this._setup()},_releaseBusyState:function(){this.busyStateResolve&&(this.busyStateResolve(),this.busyStateResolve=null)},_close:function(e){var t=n.getContext(this.element[0]).getBusyContext().addBusyState({description:"closing offcanvas"});i.close(e).then(function(){t()})},_handleAction:function(e){var n=t(e.target).parents("oj-option");n.length>0&&(this._fireActionEvent(n[0],e),this._close({selector:n[0].parentNode}))},_SetupResources:function(){this._super(),this._setupOrReleaseOffcanvas(o.tearDownSwipeActions),this._setupOrReleaseOffcanvas(o.setupSwipeActions)},_ReleaseResources:function(){this._super(),this._setupOrReleaseOffcanvas(o.tearDownSwipeActions),this._releaseBusyState()},_setupOrReleaseOffcanvas:function(e){this._applyOffcanvas("oj-offcanvas-start",e),this._applyOffcanvas("oj-offcanvas-end",e)},_closeAllOffcanvas:function(){var e=this,t=function(t){e._close({selector:t})};this._applyOffcanvas("oj-offcanvas-start",t),this._applyOffcanvas("oj-offcanvas-end",t)},_applyOffcanvas:function(e,t){var n=this.element[0].querySelector("."+e);n&&t(n)},_fireActionEvent:function(n,s){var i={};s&&(i.originalEvent=s instanceof t.Event?s.originalEvent:s);var o={detail:i,cancelable:!0,bubbles:!0};e.DomUtils.dispatchEvent(n,new CustomEvent("ojAction",o))},refresh:function(){this._super(),this._releaseBusyState(),this._setupOrReleaseOffcanvas(o.tearDownSwipeActions),this._setup(),this._setupOrReleaseOffcanvas(o.setupSwipeActions)},_createOffcanvas:function(e,t){var n=e[t];if(n&&n.length>0&&"TEMPLATE"===n[0].tagName){var s=document.createElement("div");s.className="start"===t?"oj-offcanvas-start":"oj-offcanvas-end",this.element[0].appendChild(s),this._renderAccessibleLink(s)}},_setup:function(){var s=this;this.element[0].classList.add("oj-offcanvas-inner-wrapper"),this.element[0].parentNode.classList.add("oj-offcanvas-outer-wrapper");var i=e.BaseCustomElementBridge.getSlotMap(this.element[0]),o=i[""];o&&o.length>0&&(this.m_content=o[0],this.m_content.classList.add("oj-swipeactions-content")),this._createOffcanvas(i,"start"),this._createOffcanvas(i,"end"),t(this.element).on("ojpanstart",function(e){e.isDefaultPrevented()||s._renderOffcanvas(e.target)}),t(this.element).on("ojpanend",function(){var e=n.getContext(s.element[0]).getBusyContext();s.busyStateResolve=e.addBusyState({description:"opening or closing offcanvas"})})},_renderOffcanvas:function(t,i){var o=this;t.setAttribute("role","toolbar"),t.setAttribute("data-oj-context","");var a=e.BaseCustomElementBridge.getSlotMap(this.element[0]),c=t.classList.contains("oj-offcanvas-start")?a.start[0]:a.end[0],r=n.getContext(o.element[0]).getBusyContext(),l=r.addBusyState({description:"rendering ojoptions"});s.__getTemplateEngine().then(function(e){o._render(e,t,c),i?(r=n.getContext(t).getBusyContext()).whenReady().then(function(){i(),l()}):l()},function(e){throw l(),new Error("Error loading template engine: "+e)})},_showAccessibleLinks:function(){for(var e=0,t=this.element[0].querySelectorAll("a.oj-helper-hidden-accessible"),n=0;n<t.length;n++)t[n].style.left=e+"px",t[n].className="oj-swipeactions-accessible-link",e=e+t[n].offsetWidth+5},_hideAccessibleLinks:function(){for(var e=this.element[0].querySelectorAll("a.oj-swipeactions-accessible-link"),t=0;t<e.length;t++)e[t].className="oj-helper-hidden-accessible"},_isIE11:function(){var t=e.AgentUtils.getAgentInfo();return"ie"===t.browser&&11===t.browserVersion},_renderAccessibleLink:function(s){var o=!1,a=this,c=document.createElement("a");c.setAttribute("tabIndex","0"),c.setAttribute("href","#"),c.textContent=this.getTranslatedString(s.classList.contains("oj-offcanvas-start")?"ariaShowStartActionsDescription":"ariaShowEndActionsDescription");var r=e.AgentUtils.getAgentInfo().os===e.AgentUtils.OS.ANDROID;r?(c.style.color="transparent",c.className="oj-swipeactions-accessible-link",s.classList.contains("oj-offcanvas-end")&&null!=this.element[0].querySelector("a.oj-swipeactions-accessible-link")&&(c.style.right="0px"),c.addEventListener("touchstart",function(e){o=e.touches[0].force>0},{passive:!0})):c.className="oj-helper-hidden-accessible",c.addEventListener("focus",function(){r||a._showAccessibleLinks(),a._closeAllOffcanvas()}),c.addEventListener("blur",function(e){null==e.relatedTarget||e.relatedTarget.classList.contains("oj-swipeactions-accessible-link")?null==e.relatedTarget&&a._isIE11()&&setTimeout(function(){document.activeElement.classList.contains("oj-swipeactions-accessible-link")||a._hideAccessibleLinks()},0):setTimeout(function(){r||a._hideAccessibleLinks()},0)}),c.addEventListener("click",function(e){o||(e.preventDefault(),a._renderOffcanvas(s,function(){t(s).children("oj-option").addClass("oj-swipetoreveal-action").children().attr("tabIndex",0);var e={};e.selector=s,e.autoDismiss="none",e._animate=!1;var o=document.createElement("a");o.className="oj-swipeactions-hide-actions-link",o.setAttribute("tabIndex","0"),o.setAttribute("href","#"),o.setAttribute("aria-label",a.getTranslatedString("ariaHideActionsDescription")),o.addEventListener("click",function(){a._close(e)}),r&&o.addEventListener("touchend",function(){a._close(e)});var c=n.getContext(a.element[0]).getBusyContext().addBusyState({description:"opening offcanvas"});i.open(e).then(function(){s.appendChild(o),c()})}))}),this.element[0].appendChild(c)},_render:function(e,n,s){var i=this;t(n).children("oj-option").remove();var o=[];e.execute(this.element[0],s,null).forEach(function(e){"OJ-OPTION"===e.tagName&&o.push(e)}),o.forEach(function(e){e.customOptionRenderer=i._customOptionRenderer.bind(i),n.appendChild(e)})},_customOptionRenderer:function(n){var s=this;if(!(t(n).children("div").length>0)){n.setAttribute("role","button"),n.classList.contains("oj-swipeactions-default")&&n.classList.add("oj-swipetoreveal-default");var i=document.createElement("div");i.className="oj-flex-bar oj-swipeactions-action-panel",i.addEventListener("focus",function(){s._focusInHandler(t(i))}),i.addEventListener("blur",function(){s._focusOutHandler(t(i))});var o=document.createElement("div");o.className="oj-flex-bar-center-absolute",i.appendChild(o);var a=document.createElement("div");a.className="oj-flex oj-sm-flex-direction-column",o.appendChild(a);var c=e.BaseCustomElementBridge.getSlotMap(n),r=c.startIcon;r&&r.forEach(function(e){a.appendChild(e)});var l=document.createElement("div");l.className="oj-flex-item oj-swipeactions-action-text",a.appendChild(l);var u=c[""];u&&u.forEach(function(e){l.appendChild(e)}),t(n).prepend(i)}},_destroy:function(){this.element[0].removeEventListener("touchstart",this._touchstartListener,{passive:!1}),delete this._touchstartListener}}),a.extension._WIDGET_NAME="ojSwipeActions",e.CustomElementBridge.register("oj-swipe-actions",{metadata:a})});