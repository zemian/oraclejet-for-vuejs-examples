/**
 * @license
 * Copyright (c) 2014, 2020, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojcontext","ojs/ojthemeutils"],function(e,t,i,s,n){"use strict";var r={properties:{selectedStep:{type:"string",writeback:!0},steps:{type:"Array<Object>"},translations:{type:"object",value:{}}},methods:{getStep:{},getNextSelectableStep:{},getPreviousSelectableStep:{},updateStep:{},refresh:{},setProperty:{},getProperty:{},setProperties:{},getNodeBySubId:{},getSubIdByNode:{}},events:{ojBeforeDeselect:{},ojDeselect:{},ojBeforeSelect:{},ojSelect:{}},extension:{}};
/**
 * @preserve Copyright 2013 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */e.__registerWidget("oj.ojTrain",t.oj.baseComponent,{version:"1.0.0",defaultElement:"<div>",widgetEventPrefix:"oj",options:{steps:[],selected:"",selectedStep:"",beforeDeselect:null,deselect:null,beforeSelect:null,select:null},_stepNum:0,_stepArray:null,_ComponentCreate:function(){this._super(),this._setupTrain()},_setupTrain:function(){var e=this.options,i=e.steps;this._stepNum=i.length,this._wrapper=t("<div class='oj-train-wrapper'></div>"),this._wrapper.appendTo(this.element),this._connectorWrapper=t("<div class='oj-train-connector-wrapper'></div>"),this._connectorWrapper.appendTo(this._wrapper);var s=this.element.attr("class");this._stretch=null!=s&&s.indexOf("oj-train-stretch")>=0,this._stretch&&this._connectorWrapper.css("padding","0 "+100/(2*this._stepNum)+"%"),this._connector=t("<div class='oj-train-connector'></div>"),this._connector.appendTo(this._connectorWrapper),this._stepList=t("<ul>"),this._stepList.addClass("oj-train-step-list"),this._connectorFill=t("<div class='oj-train-connector-fill'></div>"),this._connectorFill.appendTo(this._connectorWrapper),this._setupArray(),this._selectedIndex=this._getStepIndex(e.selectedStep||e.selected),-1===this._selectedIndex&&i[0]&&i[0].id&&(this._selectedIndex=0,e.selectedStep=i[0].id,e.selected=i[0].id);for(var r=0;r<this._stepNum;r++){var a=this._stepArray[r][1],o=t("<li>").addClass("oj-train-step-list-item").attr({id:a}),d=this._stepArray[r][2];this._selectedIndex===r?o.addClass("oj-selected"):d&&o.addClass("oj-disabled");var l=this._stepArray[r][4];"confirmation"===l?o.addClass("oj-confirmation"):"info"===l?o.addClass("oj-info"):"error"===l||"fatal"===l?o.addClass("oj-invalid"):"warning"===l&&o.addClass("oj-warning"),o.appendTo(this._stepList),this._drawLabel(r),this._drawStepFill(r),this._drawIndividualConnectorLine(r),this._drawButton(r),this._drawStepNumberLabel(r),this._drawMessageType(r),this._stretch&&o.css("width",100/this._stepNum+"%"),n.getThemeName().includes("redwood")&&!d&&this._selectedIndex!==r&&(this._AddHoverable(o),this._AddActiveable(o),o.on("click"+this.eventNamespace,function(e,i){i.keyCode!==t.ui.keyCode.ENTER&&"click"!==i.type||(i.preventDefault(),this._fireSelectedStepOptionChange(e,i))}.bind(this,a)))}var p=this._stepNum-1===this._selectedIndex?100:100/(2*(this._stepNum-1))+this._selectedIndex/(this._stepNum-1)*100;this._connectorFill.css({width:p+"%"}),this._stepList.appendTo(this._wrapper),this.element.addClass("oj-train")},_setupArray:function(){var e=this.options;this._stepArray=[];for(var t=0;t<this._stepNum;t++){var i=e.steps[t];this._stepArray[t]=new Array(5),this._stepArray[t][0]=i.label?i.label:null,this._stepArray[t][1]=i.id?i.id:null,this._stepArray[t][2]=!!i.disabled,this._stepArray[t][3]=!!i.visited,this._stepArray[t][4]=i.messageType?i.messageType:null}},_drawButton:function(e){var i=t("<div></div>").addClass("oj-train-button"),s=t("<span></span>"),n="";if(this._stepArray[e]){var r=this._stepArray[e][3],a=this._stepArray[e][2];if(this._selectedIndex===e?(i.addClass("oj-selected"),n=" current "):r&&!a?(i.addClass("oj-visited"),n=" visited "):r||a?i.addClass("oj-disabled"):(i.addClass("oj-default"),n=" not visited "),!this._stepArray[e][2]&&this._selectedIndex!==e){this._AddHoverable(i),this._AddActiveable(i);var o=this._stepArray[e][1];i.on("click"+this.eventNamespace,function(e,t){this._fireSelectedStepOptionChange(e,t)}.bind(this,o))}var d=this._stepList.children().eq(e).find(".oj-train-button-connector");d.length>=1?(d.children().remove(),d.append(i)):d.append(i),s.text(n),s.addClass("oj-helper-hidden-accessible"),this._stepList.children().eq(e).find("a").append(s)}},_drawMessageType:function(e){if(this._stepArray[e]&&this._stepArray[e][4]){var i=t("<div></div>").addClass("oj-train-icon oj-component-icon").attr("aria-hidden","true"),s=t("<span></span>"),n="",r=this._stepArray[e][4];"confirmation"===r?(i.addClass("oj-confirmation"),n=" Confirmation "):"info"===r?(i.addClass("oj-info"),n=" Info "):"error"===r?(i.addClass("oj-error"),n=" Error "):"fatal"===r?(i.addClass("oj-error"),n=" Error "):"warning"===r&&(i.addClass("oj-warning"),n=" Warning ");var a=this._stepList.children().eq(e).find(".oj-train-button");if(a.children().length>=2&&a.children()[1].remove(),!this._stepArray[e][2]&&this._selectedIndex!==e){var o=this._stepArray[e][1];i.on("click"+this.eventNamespace,function(e,t){this._fireSelectedStepOptionChange(e,t)}.bind(this,o))}null!=r&&(s.text(n),s.addClass("oj-helper-hidden-accessible"),this._stepList.children().eq(e).find("a").append(s),a.append(i))}},_fireOptionChange:function(e,t,i){var s={fromStep:this.getStep(e),toStep:this.getStep(t),optionMetadata:{writeback:i?"shouldWrite":"shouldNotWrite"}};if(!1!==this._trigger("beforeDeselect",i,s)&&!1!==this._trigger("beforeSelect",i,s)){var n=this._getStepIndex(e);if(-1!==n){var r=this.options.steps[n];this._previousStepIndex=n,r.visited=!0,this._optionChangePrevented=!1}this._trigger("deselect",i,s),this.options.selectedStep&&this.option("selectedStep",t,{_context:{originalEvent:i,internalSet:!0}}),this.options.selected&&this.option("selected",t,{_context:{originalEvent:i,internalSet:!0}}),this._trigger("select",i,s)}else this._optionChangePrevented=!0},_drawStepNumberLabel:function(e){var i=t("<div></div>").addClass("oj-train-button-text");i.append((e+1).toString()),this._stepList.children().eq(e).find(".oj-train-button").append(i)},_drawIndividualConnectorLine:function(e){if(e!==this._stepNum-1){var i=t("<div></div>").addClass("oj-train-step-individual-connector");e<this._selectedIndex&&i.addClass("oj-train-connector-before-selected-step"),this._stepList.children().eq(e).prepend(i)}},_drawStepFill:function(e){var i=t("<div></div>");if(i.addClass("oj-train-button-connector"),this._stepArray[e]){e<=this._selectedIndex&&i.addClass("oj-train-fill");var s=this._stepList.children().eq(e).children();i.insertBefore(s)}},_drawLabel:function(e){if(this._stepArray[e]){var i=t("<div></div>").addClass("oj-train-label-wrapper"),s=t("<a>");s.text(this._stepArray[e][0]);var n=this._stepArray[e][2];if(i.append(s),s.addClass("oj-train-label"),e===this._selectedIndex?s.addClass("oj-selected"):this._stepArray[e][3]&&!n?s.addClass("oj-visited"):n&&s.addClass("oj-disabled"),!n){s.attr("href","#"),this._focusable({element:s,applyHighlight:!0}),this._AddHoverable(s),this._AddActiveable(s);var r=this._stepArray[e][1];s.on("click keydown"+this.eventNamespace,function(e,i){i.keyCode!==t.ui.keyCode.ENTER&&"click"!==i.type||(i.preventDefault(),this._fireSelectedStepOptionChange(e,i))}.bind(this,r))}var a=this._stepList.children().eq(e).children();a.length>=2&&a[1].remove(),this._stepList.children().eq(e).append(i)}},_getStepIndex:function(e){for(var t=0;t<this._stepNum;t++)if(this._stepArray[t]&&this._stepArray[t][1]===e)return t;return-1},getStep:function(e){for(var i=0;i<this._stepNum;i++)if(this._stepArray[i]&&this._stepArray[i][1]===e)return t.extend({},this.options.steps[i]);return null},nextSelectableStep:function(){return this.getNextSelectableStep()},previousSelectableStep:function(){return this.getPreviousSelectableStep()},getNextSelectableStep:function(){for(var e=this._getStepIndex(this.options.selectedStep||this.options.selected);e<this._stepNum;e++)if(e+1<this._stepNum&&this._stepArray[e+1]&&!this._stepArray[e+1][2])return this._stepArray[e+1][1];return null},getPreviousSelectableStep:function(){for(var e=this._getStepIndex(this.options.selectedStep||this.options.selected);e>=0;e--)if(this._stepArray[e-1]&&!this._stepArray[e-1][2])return this._stepArray[e-1][1];return null},setStep:function(e){e.id&&this.updateStep(e.id,e)},updateStep:function(e,t){if(e){var i=this.getStep(e),s=this._getStepIndex(e);if(-1!==s){var n=this.options.steps[s];t.label&&(i[0]=t.label,n.label=t.label),"string"==typeof t.id&&(i[1]=t.id,n.id=t.id),"boolean"==typeof t.disabled&&(i[2]=t.disabled,n.disabled=t.disabled),"boolean"==typeof t.visited&&(i[3]=t.visited,n.visited=t.visited),t.messageType&&(i[4]=t.messageType,n.messageType=t.messageType),this.refresh()}}},_setOptions:function(e){this._super(e),this.refresh()},_setOption:function(e,t,i){if(("selectedStep"===e||"selected"===e)&&this._stepArray&&this._stepArray[this._selectedIndex]){if(t===this._stepArray[this._selectedIndex][1])return;this._fireOptionChange(this._stepArray[this._selectedIndex][1],t,null)}else this._super(e,t,i)},refresh:function(){var e,i;this._super(),this._destroy(),this._setupTrain(),null!=this._previousStepIndex&&null!=this._stepArray[this._previousStepIndex]&&(e=this._stepArray[this._previousStepIndex][4]),null!=this._selectedIndex&&null!=this._stepArray[this._selectedIndex]&&(i=this._stepArray[this._selectedIndex][4]);var n=this.getNodeBySubId({subId:"oj-train-step",index:this._selectedIndex});if(n&&null==i){var r=s.getContext(n).getBusyContext();n.classList.add("oj-train-button-selected-animation");var a=parseFloat(t(n).css("animationDuration"));if(a>0){var o=r.addBusyState({description:"The train selected button index='"+this._selectedIndex+"' is animating."});setTimeout(function(){o()},a)}}var d=this.getNodeBySubId({subId:"oj-train-step",index:this._previousStepIndex});if(d&&null==e){var l=s.getContext(d).getBusyContext();d.classList.add("oj-train-button-visited-animation");var p=parseFloat(t(d).css("animationDuration"));if(p>0){var h=l.addBusyState({description:"The train visited button index='"+this._previousStepIndex+"' is animating."});setTimeout(function(){h()},p)}}var c=this._stepList.children().eq(this._previousStepIndex).find(".oj-train-icon")[0];if(c){var _=s.getContext(c).getBusyContext();c.classList.add("oj-train-button-messaging-icon-animation");var u=parseFloat(t(c).css("animationDuration"));if(u>0){var f=_.addBusyState({description:"The train icon index='"+this._previousStepIndex+"' is animating."});setTimeout(function(){f()},u)}}var v=this._stepList.children().eq(this._selectedIndex).find(".oj-train-icon")[0];if(v){var g=s.getContext(v).getBusyContext();v.classList.add("oj-train-button-messaging-icon-animation");var y=parseFloat(t(v).css("animationDuration"));if(y>0){var j=g.addBusyState({description:"The train icon index='"+this._selectedIndex+"' is animating."});setTimeout(function(){j()},y)}}},_destroy:function(){this._stepList.children().each(function(){t(this).remove()}),this.element.removeClass("oj-train"),this.element.find(".oj-train-wrapper").remove(),this.element.find(".oj-train-connector-wrapper").remove(),this.element.find(".oj-train-step-list").remove(),this.element.find(".oj-train-step-list").remove(),this._super()},_fireSelectedStepOptionChange:function(e,t){var i=this._stepArray[this._selectedIndex][1];i!==e&&(this._fireOptionChange(i,e,t),this._optionChangePrevented||(this.refresh(),this._setFocus(e)))},_setFocus:function(e){var t=this._getStepIndex(e);this._stepList.children().eq(t).find(".oj-train-label").focus()},getNodeBySubId:function(e){if(null===e)return this.element?this.element[0]:null;var t=e.subId,i=e.index;if("number"!=typeof i||i<0||i>=this._stepNum)return null;switch(t){case"oj-train-step":case"oj-train-button":return this._stepList.children().eq(i).find(".oj-train-button")[0];case"oj-train-button-connector":return this._stepList.children().eq(i).find(".oj-train-button-connector")[0];case"oj-train-connector":return this._connector;case"oj-train-connector-fill":return this._connectorFill;case"oj-train-icon":return this._stepList.children().eq(i).find(".oj-train-icon")[0];case"oj-train-label":return this._stepList.children().eq(i).find(".oj-train-label")[0];default:return null}},getSubIdByNode:function(e){for(var i=e,s=this._stepArray?this._stepArray.length:0,n=0;n<s;n++){var r={subId:"oj-train-step",index:n},a=this.getNodeBySubId(r);if(t(i).closest(a).length>0||t(i).closest(t(a.parentNode.parentNode).find(".oj-train-label")[0]).length>0)return r}return null}}),r.extension._WIDGET_NAME="ojTrain",e.CustomElementBridge.register("oj-train",{metadata:r})});