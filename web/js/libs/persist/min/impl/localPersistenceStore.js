define(["./keyValuePersistenceStore","./logger"],function(a,b){"use strict";var c=function(b){a.call(this,b)};return c.prototype=new a,c.prototype.Init=function(a){return this._version=a&&a.version||"0",Promise.resolve()},c.prototype._insert=function(a,b,c){var d=this._createRawKey(a),e={key:a,metadata:b,value:c},f=JSON.stringify(e);return localStorage.setItem(d,f),Promise.resolve()},c.prototype.removeByKey=function(a){b.log("Offline Persistence Toolkit localPersistenceStore: removeByKey() with key: "+a);var c=this;return this.findByKey(a).then(function(b){if(b){var d=c._createRawKey(a);return localStorage.removeItem(d),Promise.resolve(!0)}return Promise.resolve(!1)})},c.prototype._createRawKey=function(a){return this._name+this._version+a.toString()},c.prototype.keys=function(){b.log("Offline Persistence Toolkit localPersistenceStore: keys()");for(var a=Object.keys(localStorage),c=[],d=0;d<a.length;d++){var e=this._name+this._version,f=a[d];if(0===f.indexOf(e)){var g=localStorage.getItem(f);if(g)try{var h=JSON.parse(g),i=h.key;i?c.push(i):c.push(f.slice(e.length))}catch(a){b.log("data is not in valid JSON format: "+g);continue}}}return Promise.resolve(c)},c.prototype.getItem=function(a){b.log("Offline Persistence Toolkit localPersistenceStore: getItem() with key: "+a);var c=this._createRawKey(a),d=localStorage.getItem(c);if(!d)return Promise.resolve();try{var e=JSON.parse(d);return Promise.resolve(e)}catch(a){return Promise.resolve()}},c});